const DOM_ELEMENTS={topOfPage:document.getElementById("top"),atkType:document.getElementById("penCritSelect"),weapon:document.getElementById("weaponSelect"),wElem:document.getElementById("weaponElementSelect"),tSize:document.getElementById("targetSizeSelect"),tRace:document.getElementById("targetRaceSelect"),tAttr:document.getElementById("targetElementSelect"),tDef:document.getElementById("targetDefSelect"),blueSet:document.getElementById("blueSet"),blueSetLabel:document.getElementById("blueSetLabel"),vesperSet:document.getElementById("vesperSet"),vesperSetLabel:document.getElementById("vesperSetLabel"),whiteSet:document.getElementById("whiteSet"),whiteSetLabel:document.getElementById("whiteSetLabel"),tDefLabel:document.getElementById("tDefLabel"),atkTypeLabel:document.getElementById("atkTypeLabel"),weaponLabel:document.getElementById("weaponLabel"),wElemLabel:document.getElementById("wElemLabel"),tSizeLabel:document.getElementById("tSizeLabel"),tRaceLabel:document.getElementById("tRaceLabel"),tAttrLabel:document.getElementById("tAttrLabel"),attack:document.getElementById("attack"),pen:document.getElementById("pen"),crit:document.getElementById("crit"),dmgStack:document.getElementById("dmgStack"),dmgStackTips:document.getElementById("dmgStackTips"),dmg:document.getElementById("dmg"),elemEnh:document.getElementById("elemEnhance"),sizeEnh:document.getElementById("sizeEnhance"),race:document.getElementById("race"),attr:document.getElementById("attr"),penLabel:document.getElementById("penLabel"),critLabel:document.getElementById("critLabel"),dmgLabel:document.getElementById("dmgLabel"),elemEnhLabel:document.getElementById("elemEnhLabel"),sizeEnhLabel:document.getElementById("sizeLabel"),raceLabel:document.getElementById("raceLabel"),attrLabel:document.getElementById("attrLabel"),hasil:document.getElementById("hasil"),rec:document.getElementById("recommendations"),submit:document.getElementById("submitBtn"),resetRek:document.getElementById("resetRekomenBtn"),resetAll:document.getElementById("resetAllBtn"),testSpear:document.getElementById("testSpear"),testReaper:document.getElementById("testReaper"),snackbar:document.getElementById("snackbar"),log:document.getElementById("log"),openLog:document.getElementById("openLog"),closeLog:document.getElementById("closeLog"),stickyStart:document.getElementById("stickyStart")},VESPER_SET={0:8,1:16,2:24,3:32,4:40,5:48,6:56,7:64,8:72,9:80},BLUE_SET={3:{30:5,40:7.5,50:10,60:12.5,70:15,80:17.5,90:20,100:22.5,110:25,120:27.5,130:30,140:32.5,150:35}},WHITE_SET={"Tier 0":30,"Tier 1":36,"Tier 2":42,"Tier 3":48,"Tier 4":54},RACE_TYPES=["Angel","Demon","Formless","Insect","Fish","Demi-Human","Undead","Dragon","Plant","Brute"],DEFENSE_TABLE={DUMMY:{def:0,dmgred:0},"Avg. MVP Lvl.130":{def:182.27,dmgred:148.1},"Avg. MINI Lvl.130":{def:206.45,dmgred:165.52},"Avg. MVP MINI Lvl.130":{def:194.36,dmgred:156.81},"Avg. MVP Lvl.140":{def:155.32,dmgred:191.35},"Avg. MINI Lvl.140":{def:161.41,dmgred:233.48},"Avg. MVP MINI Lvl.140":{def:158.37,dmgred:212.41},"Avg. MVP Lvl.150":{def:191.03,dmgred:283.92},"Avg. MINI Lvl.150":{def:198.53,dmgred:324.23},"Avg. MVP MINI Lvl.150":{def:194.78,dmgred:304.08},"Avg. Small MVP Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small"},"Avg. Medium MVP Lv.140":{def:199.62,dmgred:195.88,sizeMob:"Medium"},"Avg. Large MVP Lv.140":{def:143.05,dmgred:184.84,sizeMob:"Large"},"Avg. Small MINI Lv.140":{def:161.12,dmgred:225.97,sizeMob:"Small"},"Avg. Medium MINI Lv.140":{def:148.23,dmgred:212.13,sizeMob:"Medium"},"Avg. Large MINI Lv.140":{def:178.61,dmgred:267.37,sizeMob:"Large"},"Avg. Small MVP Lv.150":{def:161.98,dmgred:361,sizeMob:"Small"},"Avg. Medium MVP Lv.150":{def:240.07,dmgred:273.72,sizeMob:"Medium"},"Avg. Large MVP Lv.150":{def:177.51,dmgred:282.29,sizeMob:"Large"},"Avg. Small MINI Lv.150":{def:198.01,dmgred:312.15,sizeMob:"Small"},"Avg. Medium MINI Lv.150":{def:182.88,dmgred:304.72,sizeMob:"Medium"},"Avg. Large MINI Lv.150":{def:219.08,dmgred:359.67,sizeMob:"Large"},"Phreeoni Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.140":{def:238.66,dmgred:202,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.140":{def:181.21,dmgred:134,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.140":{def:306,dmgred:300,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.140":{def:256.5,dmgred:300,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.140":{def:212.68,dmgred:306.35,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.140":{def:131.97,dmgred:150.75,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.140":{def:139.98,dmgred:204.6,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.140":{def:146.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.140":{def:212.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.140":{def:245.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.140":{def:256.5,dmgred:542.27,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.140":{def:251.18,dmgred:258,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Phreeoni Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.150":{def:161.98,dmgred:361,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.150":{def:228.13,dmgred:266,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.150":{def:357.57,dmgred:367,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.150":{def:299.07,dmgred:367,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.150":{def:161.98,dmgred:361,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.150":{def:110.66,dmgred:261.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.150":{def:259.48,dmgred:361,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.150":{def:259.48,dmgred:385.89,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.150":{def:169.17,dmgred:272,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.150":{def:175.62,dmgred:311.2,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.150":{def:181.48,dmgred:361,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.150":{def:258.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.150":{def:297.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.150":{def:299.07,dmgred:575.77,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"}},ELEMENT_COUNTER_TABLE={Neutral:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:1,Shadow:1,Ghost:.7,Undead:1},Fire:{Neutral:1,Fire:.25,Water:1,Earth:1.25,Wind:1,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1.125},Water:{Neutral:1,Fire:1.25,Water:.25,Earth:1,Wind:.9,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Earth:{Neutral:1,Fire:.9,Water:1,Earth:.25,Wind:1.25,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Wind:{Neutral:1,Fire:1,Water:1.375,Earth:.9,Wind:.25,Poison:1,Holy:.7,Shadow:1,Ghost:1,Undead:1},Poison:{Neutral:1,Fire:1.125,Water:1,Earth:1.125,Wind:1.125,Poison:0,Holy:.75,Shadow:.5,Ghost:1,Undead:-.25},Holy:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:0,Shadow:1.375,Ghost:1,Undead:1.375},Shadow:{Neutral:1.125,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1,Undead:-.25},Ghost:{Neutral:.9,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:.75,Shadow:.75,Ghost:1.375,Undead:1},Undead:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1.25,Undead:0}},WEAPON_SIZE_MODIFIER_TABLE={"Empty Handed":{Large:.5,Medium:.5,Small:.5},"One-Handed Sword":{Large:.75,Medium:1,Small:.75},"Two-Handed Sword":{Large:1,Medium:.75,Small:.75},"Two-Handed Spear":{Large:1,Medium:.75,Small:.75},Dagger:{Large:.75,Medium:.75,Small:1},Katar:{Large:.75,Medium:1,Small:.75},"Light Knuckle":{Large:.75,Medium:.75,Small:1},"Heavy Knuckle":{Large:1,Medium:.75,Small:.75},GS:{Large:1,Medium:1,Small:1},"Ninja Sword":{Large:1,Medium:.75,Small:.75},"Huuma Shuriken":{Large:1,Medium:1,Small:1},Tome:{Large:.75,Medium:1,Small:1},Book:{Large:1,Medium:1,Small:1},"Two-Handed Rod":{Large:1,Medium:1,Small:1},"One-Handed Rod":{Large:1,Medium:1,Small:1},Mace:{Large:1,Medium:.75,Small:.75},"One-Handed Axe":{Large:.75,Medium:.75,Small:.75},"Two-Handed Axe":{Large:.5,Medium:.75,Small:.75},Bow:{Large:.75,Medium:1,Small:1},Instrument:{Large:.75,Medium:1,Small:.75},Whip:{Large:.75,Medium:1,Small:.75}},AppState=(()=>{let e={isResultShown:!1,isTestReaperActive:!1,isTestSpearActive:!1,isFlashActive:!1,keyboardListenersAdded:!1,currentAnimatingWeapon:null},t=new Set,a=null,r=e=>{e&&!a?a=setInterval(()=>0===t.size&&(clearInterval(a),a=null),6e4):!e&&a&&(clearInterval(a),a=null)};return{get:t=>e[t],set(a,r){if(e[a]===r)return!1;let l=e[a];return e[a]=r,t.forEach(e=>{try{e(a,r,l)}catch{t.delete(e)}}),!0},reset:()=>Object.keys(e).forEach(t=>e[t]="boolean"!=typeof e[t]&&null),subscribe:e=>"function"!=typeof e?()=>{}:(t.add(e),1===t.size&&r(!0),()=>(t.delete(e),0===t.size&&r(!1))),clearListeners:()=>(t.clear(),r(!1)),getListenerCount:()=>t.size}})(),EventManager=(()=>{let e=new WeakMap,t=new Map,a=new Map,r=0,l=null,i=e=>{e&&!l?l=setInterval(()=>{Array.from(t.entries()).filter(([,e])=>!e?.el||!(e.el instanceof Node)||!document.contains(e.el)).forEach(([e])=>s(e))},3e4):!e&&l&&(clearInterval(l),l=null)},n=(a,l,n,s=!1)=>{if(!a?.addEventListener)return null;let o=++r;return a.addEventListener(l,n,s),t.set(o,{el:a,evt:l,handler:n,opts:s}),e.has(a)||e.set(a,new Set),e.get(a).add(o),1===t.size&&i(!0),o},s=a=>{let r=t.get(a);if(!r)return!1;let{el:l,evt:n,handler:s,opts:o}=r;try{l?.removeEventListener?.(n,s,o)}catch{}t.delete(a);try{let d=e.get(l);d?.delete(a),d?.size===0&&e.delete(l)}catch{}return 0===t.size&&i(!1),!0},o=t=>{if(!t)return 0;try{let a=e.get(t);if(!a)return 0;return Array.from(a).reduce((e,t)=>e+(s(t)?1:0),0)}catch{return 0}},d=(e,t,r,l,i=!1)=>{let s=n(t,r,l,i);return s?(a.has(e)||a.set(e,new Set),a.get(e).add(s),s):null},c=e=>{let t=a.get(e);if(!t)return 0;let r=Array.from(t).reduce((e,t)=>e+(s(t)?1:0),0);return a.delete(e),r},u=()=>{i(!1),t.forEach(({el:e,evt:t,handler:a,opts:r})=>{try{e?.removeEventListener?.(t,a,r)}catch{}}),t.clear(),a.clear()},p=()=>{let e=Array.from(t.entries()).filter(([,e])=>!e?.el||!(e.el instanceof Node)||!document.contains(e.el)).map(([e])=>e);return e.forEach(s),e.length};return{add:n,remove:s,removeFromElement:o,addNS:d,removeNS:c,removeAll:u,forceCleanup:p}})(),cache=(()=>{let e={weaponSize:new Map,elementCounter:new Map,defenseData:new Map},t=()=>{Object.entries(WEAPON_SIZE_MODIFIER_TABLE).forEach(([t,a])=>Object.entries(a).forEach(([a,r])=>e.weaponSize.set(`${t}:${a}`,r))),Object.entries(ELEMENT_COUNTER_TABLE).forEach(([t,a])=>Object.entries(a).forEach(([a,r])=>e.elementCounter.set(`${t}:${a}`,r))),Object.entries(DEFENSE_TABLE).forEach(([t,a])=>e.defenseData.set(t,a))};return t(),{get:(t,a)=>e[t]?.get(a),clear:t=>t?e[t]?.clear():Object.values(e).forEach(e=>e.clear()),rewarm:t}})(),RandomGenerator=(()=>{let e=new Float64Array(500),t=0,a=()=>{for(let a=0;a<500;a++)e[a]=Math.random();t=0};return a(),{get:()=>(t>=500&&a(),e[t++]),reset:a}})(),getWeaponSizeModifier=(e,t)=>"all"!==e&&e?cache.get("weaponSize",`${e}:${t}`)??1:WEAPON_SIZE_MODIFIER_TABLE,getElementCounter=(e,t)=>"all"!==e&&e?cache.get("elementCounter",`${e}:${t||"Neutral"}`)??1:ELEMENT_COUNTER_TABLE,getTargetDefenseData=e=>e?cache.get("defenseData",e)||DEFENSE_TABLE.DUMMY:DEFENSE_TABLE,processMainCalculation=(()=>{let e=null,t=null,a=!1,r=0,l=()=>{DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate"},i=()=>{DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculating..."},n=()=>{null!==e&&(clearTimeout(e),e=null),null!==t&&(cancelAnimationFrame(t),t=null)},s=()=>{[DOM_ELEMENTS.testReaper,DOM_ELEMENTS.testSpear,DOM_ELEMENTS.resetRek,DOM_ELEMENTS.resetAll].forEach(e=>{e&&(e.disabled=!1)})},o=e=>{AppState.set("isResultShown",!0),lockAllInputs(),bindInputLockGuard(),renderMultiplierBreakdown(e),generateRecommendationTable(e),s()},d=e=>{console.error("Calculation error:",e),l(),"function"==typeof showSnackbar&&showSnackbar("Calculation failed. Please check your inputs.")};return()=>{if(a)return;if(n(),!validateRequiredFields()){l();return}a=!0,r++;let s=r;i(),e=setTimeout(()=>{e=null,s===r&&(t=requestAnimationFrame(()=>{if(t=null,s===r)try{let e=getCurrentCalculationState();if(!validateStatsVsTarget(e)){l();return}o(e),DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculate"}catch(i){d(i)}finally{s===r&&(a=!1)}}))},300)}})();function getCurrentCalculationState(){let e=e=>e&&Number(e.value)||0,t=e=>e?.value||"",a=t(DOM_ELEMENTS.atkType),r=t(DOM_ELEMENTS.weapon),l=t(DOM_ELEMENTS.wElem),i=t(DOM_ELEMENTS.tDef),n=t(DOM_ELEMENTS.tSize),s=t(DOM_ELEMENTS.tRace),o=t(DOM_ELEMENTS.tAttr),d=e(DOM_ELEMENTS.vesperSet),c=0,u=0,p=DOM_ELEMENTS.blueSet;if(p?.selectedIndex>=0){let m=p.options[p.selectedIndex];if(m){let g=e(p),h=m.textContent;h.includes("*3")?c=g:h.includes("*8")&&(u=g)}}let $=e(DOM_ELEMENTS.whiteSet),b=e(DOM_ELEMENTS.attack),M=e(DOM_ELEMENTS.pen),E=e(DOM_ELEMENTS.crit),_=e(DOM_ELEMENTS.dmg),S=e(DOM_ELEMENTS.elemEnh),f=e(DOM_ELEMENTS.sizeEnh),v=e(DOM_ELEMENTS.race),L=e(DOM_ELEMENTS.attr),y=e(DOM_ELEMENTS.dmgStack),T=AppState.get("isTestReaperActive"),w=AppState.get("isTestSpearActive"),D={baseAttack:b,atkType:a,pen:M,crit:E,dmg:_,sizeEnh:f,elemEnh:S,race:v,attr:L,weapon:r,tSize:n,wElem:l,tAttr:o,tRace:s,tDefKey:i,vesper:d,white:$,dmgStack:y,blue3:c,blue8:u,reaperValue:T?l!==o&&("Neutral"!==l||o)?28:84:0,spearValue:w?84:0},N=calculateMultiplier({...D,extras:{vesper:D.vesper,white:D.white,dmgStack:D.dmgStack,blue3:D.blue3,blue8:D.blue8,reaperValue:D.reaperValue,spearValue:D.spearValue}});return{...D,...N}}function calculateMultiplier(e={}){let{baseAttack:t,atkType:a,pen:r,crit:l,dmg:i,sizeEnh:n,elemEnh:s,race:o,attr:d,weapon:c,tSize:u,wElem:p,tAttr:m,tRace:g,tDefKey:h,extras:$={}}=e,b={vesper:"Vesper",blue3:"BlueGroup3",white:"White",dmgStack:"Final DMG Bonus",reaperValue:"Reaper",blue8:"BlueGroup8",spearValue:"Spear"},{def:M,dmgred:E}=getTargetDefenseData(h),_=0;if("crit"===a)_=(l||0)/100;else if("pen"===a){let S=(r||0)-(M||0);S>0&&(_=(S>=150?2*S-150:S)/100)}let f=i-E,v=getWeaponSizeModifier(c,u),L=getElementCounter(p,m),y=(t||1)*(1+_)*(1+f/100)*(v+n/100)*(L+s/100)*(1+(m?d/100:0))*(1+(g?o/100:0)),T=(e,t)=>{let a=[],r=[];e.forEach(e=>{let l=$[e]||0;if(l>0){let i=l/100;a.push({key:b[e],type:t,value:i}),r.push(i)}});let l=r.reduce((e,t)=>e+t,0);return{items:a,sum:l,factor:1+l}},w=T(["vesper","blue3","white","dmgStack","reaperValue"],"extra1"),D=T(["blue8","spearValue"],"extra2"),N=y*w.factor*D.factor,k=($.spearValue||0)/100,A=($.reaperValue||0)/100,O=1+(w.sum-A),I=1+(D.sum-k),z=y*w.factor*I,C=y*O*D.factor,F=y*O*I,x=z>0?(N-z)/z*100:0,B=C>0?(N-C)/C*100:0,R=[...w.items];w.sum>0&&R.push({type:"extra1",sum:w.sum,factor:w.factor}),R.push(...D.items),D.sum>0&&R.push({type:"extra2",sum:D.sum,factor:D.factor});let P="pen"===a,q=!!(g&&o>0),H=!!(m&&d>0),G=w.sum>0,V=D.sum>0,W=[{key:"baseAtk",label:"Attack",val:t,mult:t||1},{key:"main",label:P?"Type (PEN)":"Type (CRIT)",val:P?r:l,mult:1+_},{key:"dmg",label:"Final P/M DMG BNS",val:i,mult:1+f/100},{key:"elem",label:"Element",val:s,mult:L+s/100,extra:`counter ${L}`},{key:"size",label:"Size",val:n,mult:v+n/100,extra:`mod ${v}`},{key:"race",label:"Race",val:o,mult:1+o/100,show:q},{key:"attr",label:"Attribute",val:d,mult:1+d/100,show:H},{key:"extra",label:"Extra#1",val:w.sum,mult:w.factor,show:G},{key:"extraTwo",label:"Extra#2",val:D.sum,mult:D.factor,show:V},{key:"contribution",label:"Flash Contribution",show:x>0||B>0}];return{mult:N,pctSpear:x,pctReaper:B,pctReaperSpear:F>0?(N-F)/F*100:0,def:M,dmgred:E,effDmgVal:f,atkF:_,sizeModifier:v,elementCounter:L,breakdownData:{factorList:W,isPenMode:P,includeRace:q,includeAttr:H,includeExtra:G,includeExtraTwo:V},parts:{baseMult:y,extraGroups:R,extra1Factor:w.factor,extra2Factor:D.factor,extra1Sum:w.sum,extra2Sum:D.sum}}}function renderMultiplierBreakdown(e){if(!AppState.get("isResultShown"))return;let t=DOM_ELEMENTS.hasil,a=t?.dataset?.showFullPrecision==="1",r=e=>NumberFormatter.format(e,a),l=e=>`<span data-raw-value="${e}">${r(e)}</span>`,{mult:i,def:n,dmgred:s,pen:o,crit:d,dmg:c,wElem:u,tAttr:p,tSize:m,weapon:g,atkType:h,tRace:$,vesper:b,blue3:M,blue8:E,white:_,tDefKey:S,elementCounter:f,sizeModifier:v,parts:L={},breakdownData:y={}}=e,{extraGroups:T=[],extra1Factor:w=1,extra2Factor:D=1}=L,{factorList:N=[],isPenMode:k=!1}=y,A={Vesper:"Vesper SET",BlueGroup3:"Blue SET (Ferocity)",BlueGroup8:"Blue SET",White:"White SET (110*3)",Reaper:"Reaper Scythe",Spear:"Divinity#1 Flash: Spear of Eternity"},O={extra1:{items:[],factor:w},extra2:{items:[],factor:D}};T.forEach(e=>{let t=e.type;"sum"in e&&"factor"in e?O[t].factor=e.factor:"key"in e&&"value"in e&&O[t].items.push(e)});let I=e=>e.includes("Tools assume")||e.includes("uptime")||e.includes("Elements")||e.includes("This bonus"),z=e=>e.map(e=>`<li${I(e)?' class="note"':""}>${e}</li>`).join("");function C(e,t,a){let i=O[e],n=[],s=[];i.items.forEach(e=>{let t=A[e.key]||e.key,r=l(100*e.value);if("Reaper"===e.key)n.push(`${t}: ${a.wElem} vs ${a.tAttr||"Neutral"} <button type="button" id="reaperTips" class="tooltip-button"></button>`,`${r} / 100`);else if("Spear"===e.key)n.push(`${A[e.key]} <button type="button" id="spearTips" class="tooltip-button"></button>`,`${r} / 100`);else{let i=`${t}: ${r}`;switch(e.key){case"Vesper":a.vesper&&(i=`${t}: Tier ${(a.vesper-8)/8}`);break;case"BlueGroup3":a.blue3&&(i=`${t}: Level ${4*a.blue3+10}*3`);break;case"White":a.white&&(i=`${t}: Tier ${(a.white-30)/6}`);break;case"BlueGroup8":a.blue8&&(i=`${t}: ${a.blue8}%`)}n.push(i,`${r} / 100`)}s.push(l(e.value))});let o=s.join(" + ");return n.push(`1 + ${o} \u2192 <code data-raw-mult="${i.factor}">\u00D7${r(i.factor)}</code>`),{title:t,lines:n}}let F=[],x=[],B={...e,extras:O,LABELS:A,isPenMode:k};N.forEach((e,t)=>{let a=function e(t,a){if(!1===t.show&&"contribution"!==t.key)return{html:`<li>${t.label}: \u00D71.00 (no stat)</li>`,mult:`1.00 (no ${t.label.toLowerCase()})`};let i=null;switch(t.key){case"baseAtk":return{html:"",mult:r(t.mult)};case"main":if(a.isPenMode){let n=[`Raw PEN + Final PEN: ${l(a.pen)}`,`Target DEF: ${l(a.def)}`],s=a.pen-a.def;s>=150?n.push(`1.00 + ((( ${l(a.pen)} - ${l(a.def)} ) \u00D7 2 ) - 150 ) / 100`,`1.00 + ( ${l(2*s-150)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`):n.push(`1.00 + (( ${l(a.pen)} - ${l(a.def)} ) / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`),i={title:`Attack Type: PEN vs ${a.tDefKey}`,lines:n}}else i={title:`Attack Type: CRIT vs ${a.tDefKey}`,lines:[`Crit DMG: ${l(a.crit)}`,`1.00 + ( ${l(a.crit)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"dmg":i={title:"Final P/M Damage Bonus",lines:[`P/M BO: ${l(a.dmg)}`,`Target Reduction: ${l(a.dmgred)}`,`1.00 + (( ${l(a.dmg)} - ${l(a.dmgred)} ) / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"elem":i={title:`Element: ${a.wElem} vs ${a.tAttr||"Neutral<button type='button' id='elemCtrTips' class='tooltip-button'></button>"}`,lines:[`Counter: ${l(a.elementCounter)}`,`${a.wElem} Enhance: ${l(t.val)}`,`${l(a.elementCounter)} + ( ${l(t.val)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"size":i={title:`Size: ${a.weapon} vs ${a.tSize}`,lines:[`Modifier: ${l(a.sizeModifier)}`,`${a.tSize} Enhance: ${l(t.val)}`,`${l(a.sizeModifier)} + ( ${l(t.val)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"race":i={title:`Race: ${a.tRace}`,lines:[`DMG to ${a.tRace}: ${l(t.val)}`,`1.00 + ( ${l(t.val)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"attr":i={title:`Attribute: ${a.tAttr}`,lines:[`DMG to ${a.tAttr} Attribute: ${l(t.val)}`,`1.00 + ( ${l(t.val)} / 100 ) \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code>`]};break;case"extra":i=C("extra1","Extra#1: Final DMG Bonus",a);break;case"extraTwo":i=C("extra2","Extra#2: Bonus DMG to MVP/MINI",a);break;case"contribution":let o=a.pctSpear>0,d=a.pctReaper>0;if(!o&&!d)return{html:"",mult:""};let c=e=>`<code>\u2248${Math.trunc(e/2)}%</code>`,u=(e,t)=>`${e}: ${c(t)}`,p=[];o&&d?p.push(u("Spear Flash",a.pctSpear)+" damage boost.",u("Reaper Flash",a.pctReaper)+" damage boost.",`Both flashes gives you ${c(a.pctReaperSpear)} total damage increase.`):o?p.push(`Spear Flash boost: ${c(a.pctSpear)}`):p.push(`Reaper Flash boost: ${c(a.pctReaper)}`),i={title:"How Much Flash Boosts Your Damage<button type='button' id='flashTips' class='tooltip-button'></button>",lines:p};break;default:return{html:`<li>${t.label}: ${l(t.val)} \u2192 <code data-raw-mult="${t.mult}">\u00D7${r(t.mult)}</code></li>`,mult:r(t.mult)}}let m=`<li>${i.title}<ul>${z(i.lines)}</ul></li>`;return{html:m,mult:r(t.mult)}}(e,B);F.push(a.html),"contribution"!==e.key&&x.push((0===t?"":"\xd7 ")+a.mult)});let R=[m,$,p].filter(Boolean).join(" + "),P=`By default, every factor starts at \u00D71.00<button type='button' id='breakdownTips' class='tooltip-button'></button>
Numbers`,q=document.createTextNode(" how it changes with your stats."),H=PrecisionToggle.create(t,e=>{PrecisionToggle.refreshNumbers(t,e)}),G=dropdownManager.createSwapSelect(e,k);t.querySelectorAll("[data-listener-id]").forEach(e=>{let t=e.dataset.listenerId;t&&EventManager.remove(parseInt(t))}),t.innerHTML=`
    <div class="multiplier-breakdown" id="multiplier-breakdown">
      <blockquote class="noted">${P.replace(/\n/g,"<br>")}</blockquote>
      <ul class="factor-breakdown">${F.join("")}</ul>
      <hr class="separ">
      <div class="breakdown-swap-wrapper" id="swap-wrapper"></div>
      <p class="sum-head">Your base multiplier to <i>${R} (${S})</i></p>
      <div class="last-calc">${x.join(" ")}<br>\u2248<code data-raw-mult="${i}">\u00D7${r(i)}</code><button type="button" id="attackTips" class="tooltip-button"></button></div>
      <blockquote class="noted">Only base multipliers! Real output depends on class, skills, buffs (vesper, blue, or white stack), and more. More accurate? Just use <a class="job-sim" target="_blank" href="//discord.com/channels/784407151342256148/909016309218541568/1407521807459811328">job sim!</a></blockquote>
    </div>`;let V=t.querySelector(".noted");V.appendChild(H),V.appendChild(q),t.querySelector("#swap-wrapper").appendChild(G)}const NumberFormatter={format(e,t){let a=Number(e)||0,r=a%1==0,l=Math.abs(a);if(t){if(l>=99999)return Math.floor(a).toString();if(r)return a.toString();let i=a.toFixed(6).replace(/(\.\d*?)0+$/,"$1");if(i.endsWith("."))return a.toFixed(2);let n=i.split(".");return n[1]&&1===n[1].length?a.toFixed(2):i}if(l>99999){let s=l>=1e6?1e6:1e3;return`${Math.floor(a/s)}${1e6===s?"M":"K"}`}return r?a.toString():a.toFixed(2)}},PrecisionToggle={create(e,t){let a=e?.dataset?.showFullPrecision==="1",r=document.createElement("button");r.className="toggle-precision job-sim",r.type="button",r.textContent=a?"hide":"show";let l=EventManager.add(r,"click",a=>{if(a.preventDefault(),a.stopPropagation(),!e?.dataset)return;let l="1"===e.dataset.showFullPrecision?"0":"1";e.dataset.showFullPrecision=l,r.textContent="1"===l?"hide":"show",t("1"===l),"function"==typeof showSnackbar&&showSnackbar("1"===l?"Precise numbers displayed":"Rounded numbers displayed")});return r.dataset.listenerId=l,r},refreshNumbers(e,t){let a=e=>NumberFormatter.format(e,t);e.querySelectorAll("[data-raw-value]").forEach(e=>{let t=parseFloat(e.dataset.rawValue);e.textContent=a(t)}),e.querySelectorAll("code[data-raw-mult]").forEach(e=>{let t=parseFloat(e.dataset.rawMult);e.textContent=`\u00D7${a(t)}`})}};function generateRecommendationTable(e){if(!AppState.get("isResultShown"))return;let t=(e,t=RECOMMENDATION_CONFIG.jitter)=>{let{randomMode:a,clampMaxFraction:r,clampMaxAbsolute:l}=RECOMMENDATION_CONFIG;if("clamp"===a){let i=(2*RandomGenerator.get()-1)*t,n=Math.min(r*t,l);return Math.max(0,e*(1+Math.max(Math.min(i,n),-n)))}if("normal"===a){let s=0,o=0;for(;0===s;)s=RandomGenerator.get();for(;0===o;)o=RandomGenerator.get();let d=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*o);return Math.max(0,e*(1+d*t*.5))}return Math.max(0,e*(1+(2*RandomGenerator.get()-1)*t))},a=(e,t,a)=>{let{smallThreshold:r,smallExp:l,smallMin:i}=RECOMMENDATION_CONFIG,n=t+a;return n>0&&n<r?Math.max(Math.pow(e,l),i):e},r=(e,t,a,r)=>e>=t?r?t+a:e+a:t,l=(e,t)=>e<t?e:t-t*(.01+.02*RandomGenerator.get()),i=e=>{let t=Math.round(e);return t%10==0?t+1:t},n=(e,t)=>{let a=Math.round(+e||0)-Math.round(+t||0),r=RECOMMENDATION_CONFIG.upDownThreshold;return a>=r?"up":a<=-r?"down":"neutral"},s="pen"===e.atkType,o=e.tRace,d=e.tAttr,c=+e.race||0,u=+e.attr||0,p=!!o&&c>0,m=!!d&&u>0,g=+e.mult||1,h=+e.baseAttack||1,$={main:s?+e.pen||0:+e.crit||0,dmg:+e.dmg||0,size:+e.sizeEnh||0,elem:+e.elemEnh||0,attr:m?u:0,race:p?c:0},b=calculateRecommendationWeights({includeRace:p,includeAttr:m,baseMain:$.main,baseDmg:$.dmg,baseElem:$.elem,baseSize:$.size,baseRace:$.race,baseAttr:$.attr}),{centerScale:M,raceAttrCap:E,smallThreshold:_,raceAttrSoloCap:S,raceAttrTol:f,ratioMin:v,ratioMax:L,maxAttempts:y,jitter:T,jitterStep:w,jitterStepEvery:D,jitterMax:N}=RECOMMENDATION_CONFIG,k={main:$.main*(1+b.main*M),dmg:$.dmg*(1+b.dmg*M),elem:$.elem*(1+b.elem*M),size:$.size*(1+b.size*M)},A=$.race+$.attr,O=p?a($.race,$.race,$.attr):0,I=m?a($.attr,$.race,$.attr):0,z={race:p?Math.min(O*(1+b.race*M),E):0,attr:m?Math.min(I*(1+b.attr*M),E):0,adjustedRace:O,adjustedAttr:I},C={blue3:+e.blue3||0,blue8:+e.blue8||0,vesper:+e.vesper||0,white:+e.white||0,dmgStack:+e.dmgStack||0,reaperValue:+e.reaperValue||0,spearValue:+e.spearValue||0},F=p&&m&&A>0&&A<_?RECOMMENDATION_CONFIG.forSmallCats:RECOMMENDATION_CONFIG.cats,x=["STAT",s?"PEN":"CRIT","P/M BO","Element","Size"];p&&x.push("Race"),m&&x.push("Attribute"),x.push("Multiplier","∆");let B=[],R=x.map(e=>`<th>${e}</th>`).join(""),P=$.race+$.attr,q=z.adjustedRace+z.adjustedAttr,H=p&&m?r(P,E,f,P>0&&P<_):0,G=p?$.race:$.attr,V=p?z.adjustedRace:z.adjustedAttr,W=(p||m)&&!(p&&m)?r(G,S,f,G>0&&G<_):0,U={baseAttack:h,atkType:s?"pen":"crit",weapon:e.weapon||"",tSize:e.tSize||"",wElem:e.wElem||"",tAttr:d||"",tRace:o||"",tDefKey:e.tDefKey||"",extras:C};for(let Y=0,X=F.length;Y<X;Y++){let j=F[Y],K=new Set,Z=new Set,J=new Set,Q=[],ee=0,et=T;for(;Q.length<5&&ee<y;){ee++;let ea={pen:+e.pen||0,crit:+e.crit||0,dmg:t(k.dmg,et),elem:t(k.elem,et),size:t(k.size,et)};ea[s?"pen":"crit"]=t(k.main,et);let er=0,el=0;if(m&&p){let ei=l(Math.min(t(q,et),H),H),en=v+RandomGenerator.get()*(L-v);er=ei*en,el=ei*(1-en);let es=er+el;if(es>H){let eo=l(H,H)/es;er*=eo,el*=eo}}else if(p||m){let ed=l(Math.min(t(V,et),W),W);p?er=ed:el=ed}let{mult:ec}=calculateMultiplier({...U,pen:+ea.pen||0,crit:+ea.crit||0,dmg:+ea.dmg||0,sizeEnh:+ea.size||0,elemEnh:+ea.elem||0,race:+er||0,attr:+el||0}),eu=ec/g;if(ec<=g||eu<j.min||eu>j.max)continue;let ep=i(s?ea.pen:ea.crit),em=i(ea.dmg),eg=i(ea.elem),eh=i(ea.size),e$=p?i(er):null,eb=m?i(el):null,eM=e$||"-",eE=eb||"-",e_=`${ep}|${em}|${eg}|${eh}|${eM}|${eE}`,eS=`${ep}|${em}|${eg}|${eh}|${e$}|${eb}`;if(K.has(e_)||J.has(eS))continue;let ef=(ec-g)/g*100,ev=Number(ef.toFixed(1));!Z.has(ev)&&(!(ep>$.main)||!(em>$.dmg)||!(eg>$.elem)||!(eh>$.size)||p&&!(e$>$.race)||m&&!(eb>$.attr))&&(K.add(e_),Z.add(ev),J.add(eS),Q.push({main:ep,dmg:em,elem:eg,size:eh,attr:eb,race:e$,newMultiplier:ec,deltaPercent:ef}),Q.length<5&&ee%D==0&&(et=Math.min(et+w,N)))}if(0===Q.length)continue;Q.sort((e,t)=>t.deltaPercent-e.deltaPercent||t.newMultiplier-e.newMultiplier||t.main-e.main);let eL=Q.map((e,t)=>{let a=[`<td class="build">BUILD#${t+1}</td>`,`<td><span class="${n(e.main,$.main)}">${e.main}</span></td>`,`<td><span class="${n(e.dmg,$.dmg)}">${e.dmg}</span></td>`,`<td><span class="${n(e.elem,$.elem)}">${e.elem}</span></td>`,`<td><span class="${n(e.size,$.size)}">${e.size}</span></td>`];return p&&a.push(`<td><span class="${n(e.race,$.race)}">${e.race}</span></td>`),m&&a.push(`<td><span class="${n(e.attr,$.attr)}">${e.attr}</span></td>`),a.push(`<td class="mult">\u00D7${e.newMultiplier.toFixed(2)}</td>`,`<td class="delta">+${e.deltaPercent.toFixed(1)}%</td>`),`<tr>${a.join("")}</tr>`}).join(""),ey=['<td class="yours-label">YOURS</td>',`<td><span>${$.main}</span></td>`,`<td><span>${$.dmg}</span></td>`,`<td><span>${$.elem}</span></td>`,`<td><span>${$.size}</span></td>`];p&&ey.push(`<td><span>${$.race}</span></td>`),m&&ey.push(`<td><span>${$.attr}</span></td>`),ey.push(`<td class="mult current-mult">\u00D7${e.mult.toFixed(2)}</td>`,"<td id=\"table-help\" class=\"delta current-delta\"><button type='button' id='tableTips' class='tooltip-button'></button></td>");let eT=`<tr class="your-stats-values">${ey.join("")}</tr>`;B.push(`<div class="table-wrapper"><table class="recommend-table"><caption>Increase ${j.label}</caption><tr>${R}</tr><tbody>${eL}${eT}</tbody></table></div>`)}DOM_ELEMENTS.rec.innerHTML=B.join("")}const calculateRecommendationWeights=e=>{if(!AppState.get("isResultShown"))return;let{includeRace:t,includeAttr:a,baseMain:r,baseDmg:l,baseElem:i,baseSize:n,baseRace:s,baseAttr:o}=e,{bias:d,smallExp:c,smallMin:u,raceAttrCap:p}=RECOMMENDATION_CONFIG,m=[r*d.main,l*d.dmg,i*d.elem,n*d.size],g=Math.max(...m,1),h=Math.max(m.reduce((e,t)=>e+t/g,0),1e-4),$=t||a,b=$?.75:1,M={main:m[0]/g/h*b,dmg:m[1]/g/h*b,elem:m[2]/g/h*b,size:m[3]/g/h*b,race:0,attr:0};if(!$){let E=Object.values(M).reduce((e,t)=>e+t,0);return Object.keys(M).forEach(e=>M[e]/=E),M}let _=1-b,S=t?Math.max(Math.pow(s,c),u):0,f=a?Math.max(Math.pow(o,c),u):0,v=t&&S>0&&S<p,L=a&&f>0&&f<p;if(v&&L){let y=S+f;M.race=S/y*_,M.attr=f/y*_}else if(v)M.race=_;else if(L)M.attr=_;else{let T=.25*_;["main","dmg","elem","size"].forEach(e=>M[e]+=T)}let w=Object.values(M).reduce((e,t)=>e+t,0);return Object.keys(M).forEach(e=>M[e]/=w),M},regenerateRecommendations=()=>{AppState.get("isResultShown")&&(generateRecommendationTable(getCurrentCalculationState()),showSnackbar?.("Table Refreshed!"))},RECOMMENDATION_CONFIG={randomMode:"clamp",maxAttempts:500,centerScale:.25,jitter:.12,jitterStep:.025,jitterStepEvery:35,jitterMax:.5,clampMaxFraction:3.5,clampMaxAbsolute:.2,upDownThreshold:3,raceAttrCap:310,raceAttrSoloCap:250,raceAttrTol:6,smallThreshold:115,smallMin:85,smallExp:.75,ratioMin:.32,ratioMax:.64,ratioNoise:.12,bias:{main:1,dmg:.95,elem:.9,size:.9,race:.72,attr:.72},cats:[{label:"6-12%",min:1.06,max:1.12},{label:"18-24%",min:1.18,max:1.24},{label:"32-48%",min:1.32,max:1.48},{label:"64-128%",min:1.64,max:2.28}],forSmallCats:[{label:"84-168%",min:1.84,max:2.68},{label:"180-270%",min:2.8,max:3.7},{label:"320-480%",min:4.32,max:5.8},{label:"510-720%",min:6.1,max:8.2}]},isMobile=()=>window.innerWidth<480,debounceMap=new Map;let debounceCleanupInterval=null;const startDebounceCleanup=()=>{debounceCleanupInterval||(debounceCleanupInterval=setInterval(()=>{let e=Date.now(),t=Array.from(debounceMap.entries()).filter(([,t])=>!t||t.timestamp&&e-t.timestamp>1e4);t.forEach(([e,t])=>{t?.timerId&&clearTimeout(t.timerId),debounceMap.delete(e)}),0===debounceMap.size&&(clearInterval(debounceCleanupInterval),debounceCleanupInterval=null)},5e3))},smoothDebounce=(e,t,a)=>{let r=debounceMap.get(a);if(r?.timerId&&clearTimeout(r.timerId),r?.running)return;let l=setTimeout(()=>{let t=debounceMap.get(a);debounceMap.set(a,{...t,running:!0}),e(),debounceMap.delete(a)},t);debounceMap.set(a,{timerId:l,running:!1})};function simulateFlash(e){if(!AppState.get("isResultShown"))return;let t={buttonCooldown:1600,flashTrigger:150,calculationDelayOn:950,calculationDelayOff:100,animationDuration:1800},a=e?.currentTarget;if(!a||a.disabled)return;a.disabled=!0,setTimeout(()=>a.disabled=!1,t.buttonCooldown);let r=a===DOM_ELEMENTS.testReaper,l=r?"reaper":"spear",i=r?"spear":"reaper",n=r?"isTestReaperActive":"isTestSpearActive",s=AppState.get(n),o=!s;AppState.set(n,o),a.classList.toggle("activated",o);let d=!s&&o;d&&AppState.get("currentAnimatingWeapon")&&AppState.get("currentAnimatingWeapon")!==l&&["flash","calc"].forEach(e=>{let t=`${i}-${e}`,a=debounceMap.get(t);a&&(clearTimeout(a),debounceMap.delete(t))}),d&&(AppState.set("currentAnimatingWeapon",l),setTimeout(()=>{AppState.get("currentAnimatingWeapon")===l&&AppState.set("currentAnimatingWeapon",null)},t.calculationDelayOn+100),smoothDebounce(triggerPulseFlash,t.flashTrigger,`${l}-flash`),DOM_ELEMENTS.submit.textContent="Calculating...");let c=d?t.calculationDelayOn:t.calculationDelayOff;smoothDebounce(()=>{"function"==typeof processMainCalculation&&processMainCalculation()},c,`${l}-calc`),"function"==typeof showSnackbar&&showSnackbar(`${r?"Reaper":"Spear"} ${o?"Flash Active":"Off"}`)}function triggerPulseFlash(){if(!AppState.get("isResultShown")||!isMobile()||AppState.get("isFlashActive"))return;let e={animationDuration:1800,emergencyCleanup:2200};AppState.set("isFlashActive",!0),requestAnimationFrame(()=>{let t=document.createElement("div"),a=document.createElement("div");t.className="lightning-flash-overlay",a.className="lightning-icon",t.appendChild(a);try{document.body.appendChild(t)}catch(r){console.warn("Flash DOM insertion failed",r),AppState.set("isFlashActive",!1);return}let l=()=>{t.parentNode&&t.parentNode.removeChild(t),AppState.set("isFlashActive",!1)};setTimeout(l,e.animationDuration),setTimeout(()=>{AppState.get("isFlashActive")&&t.parentNode&&l()},e.emergencyCleanup)})}const TooltipManager=(()=>{let e=new Map,t=new Map,a=null,r=null,l={},i={HIDE_DELAY:300,THROTTLE_DELAY:16,MARGIN:16,OFFSET:12},n=a=>{if(e.has(a)){let r=e.get(a);r?.cleanup&&r.cleanup(),e.delete(a)}if(t.has(a)){let l=t.get(a);l?.listenerIds&&l.listenerIds.forEach(e=>EventManager.remove(e)),t.delete(a)}},s=a=>{a.querySelectorAll&&(e.forEach((t,r)=>{r!==a&&a.contains(r)&&(t?.cleanup&&t.cleanup(),e.delete(r))}),t.forEach((e,r)=>{r!==a&&a.contains(r)&&(e?.listenerIds&&e.listenerIds.forEach(e=>EventManager.remove(e)),t.delete(r))}))},o=()=>{!a&&"undefined"!=typeof MutationObserver&&(a=new MutationObserver(e=>{let t=new Set;e.forEach(e=>{e.removedNodes.forEach(e=>{1===e.nodeType&&t.add(e)})}),t.forEach(e=>{n(e),s(e)})})).observe(document.body,{childList:!0,subtree:!0})},d=(e,t)=>{if(t.startsWith("#"))return e.id===t.slice(1);if(t.startsWith("."))return e.classList.contains(t.slice(1));if(t.startsWith("[")){let a=t.match(/\[([^\]]+)\]/);if(a){let[r,l]=a[1].split("=");return l?e.getAttribute(r)===l.replace(/['"]/g,""):e.hasAttribute(r)}}return e.matches(t)},c=e=>{e.classList.contains("tooltip-button")&&!e.querySelector("svg")&&(e.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" height="70" fill="#dcddde" viewBox="0 -960 960 960" width="70">
          <path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
        </svg>
      `)},u=e=>{t.has(e)||(c(e),Object.entries(l).forEach(([t,a])=>{try{d(e,t)&&M(e,a)}catch(r){}}))},p=()=>{!r&&"undefined"!=typeof MutationObserver&&0!==Object.keys(l).length&&(r=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&(u(e),e.querySelectorAll&&Object.keys(l).forEach(t=>{try{let a=e.querySelectorAll(t);a.forEach(e=>u(e))}catch(r){}}))})})})).observe(document.body,{childList:!0,subtree:!0})},m=()=>{r&&(r.disconnect(),r=null)},g=()=>{a&&(a.disconnect(),a=null)},h=e=>{e.style.cssText="visibility:hidden;display:block";let t=e.offsetWidth,a=e.offsetHeight;return e.style.cssText="",{width:t,height:a}},$=(e,t,a,r,l)=>{let n=e.left+t+e.width/2,s=window.innerWidth-r-i.MARGIN,o=Math.max(i.MARGIN,Math.min(n-r/2,s)),d=e.top+a-l-i.OFFSET,c=!1;return d<i.MARGIN+a&&(d=e.bottom+a+i.OFFSET,c=!0),{left:o,top:d,isFlipped:c}},b=(t,a)=>{if(!t||!a)return;let r=e.get(t);r?.cleanup&&(r.cleanup(),e.delete(t));let l=document.createElement("div");l.className="tooltip-wrap",l.innerHTML=a,document.body.appendChild(l);let n=!1,s=null,o=`tooltip-active-${Date.now()}-${Math.random()}`,d=()=>{s&&(clearTimeout(s),s=null),EventManager.removeNS(o),l.parentNode&&l.parentNode.removeChild(l),e.delete(t)},c=()=>{if(!document.contains(t)||!document.contains(l)){d();return}let e=t.getBoundingClientRect(),a=window.pageXOffset,r=window.pageYOffset,{width:i,height:n}=h(l),{left:s,top:o,isFlipped:c}=$(e,a,r,i,n);l.classList.toggle("flipped",c),l.style.transform=`translate(${s}px, ${o}px)`},u=()=>{n||(s&&(clearTimeout(s),s=null),c(),n=!0,l.classList.add("show"))},p=()=>{n&&(l.classList.remove("show"),n=!1,s=setTimeout(()=>{d()},i.HIDE_DELAY))},m=e=>{!(!n||t.contains(e.target))&&(l.contains(e.target)||p())},g=e=>{"Escape"===e.key&&n&&p()},b=()=>{n&&(s&&(clearTimeout(s),s=null),s=setTimeout(()=>{c(),s=null},i.THROTTLE_DELAY))};EventManager.addNS(o,document,"click",m),EventManager.addNS(o,document,"touchend",m,{passive:!0}),EventManager.addNS(o,document,"keydown",g),EventManager.addNS(o,window,"resize",b,{passive:!0}),EventManager.addNS(o,window,"scroll",b,{passive:!0}),e.set(t,{tooltip:l,cleanup:d,namespace:o}),u()},M=(e,r)=>{if(!e||!r)return;let l=t.get(e);if(l&&l.content===r)return;l?.listenerIds&&l.listenerIds.forEach(e=>EventManager.remove(e));let i=`tooltip-lazy-${Date.now()}-${Math.random()}`,n=[],s=t=>{t?.cancelable&&t.preventDefault(),b(e,r)},d=t=>{let a=t.target;(a===e||e.contains(a))&&s(t)};n.push(EventManager.addNS(i,e,"click",d),EventManager.addNS(i,e,"touchend",d,{passive:!1})),t.set(e,{content:r,namespace:i,listenerIds:n}),1!==t.size||a||o()},E=()=>{m(),g(),e.forEach(({cleanup:e})=>{e&&e()}),e.clear(),t.forEach(({listenerIds:e})=>{e&&e.forEach(e=>EventManager.remove(e))}),t.clear(),l={}};return{registerLazyTooltip:M,startAutoInit:p,stopAutoInit:m,setConfig(e){l=e,p()},destroyAll:E}})(),setupTooltips=e=>{TooltipManager.setConfig(e),Object.entries(e).forEach(([e,t])=>{let a="string"==typeof e?document.querySelectorAll(e):e instanceof Element?[e]:[];a.forEach(e=>{e instanceof Element&&(e.classList.contains("tooltip-button")&&!e.querySelector("svg")&&(e.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" height="70" fill="#dcddde" viewBox="0 -960 960 960" width="70">
              <path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
            </svg>
          `),TooltipManager.registerLazyTooltip(e,t))})})};setupTooltips({"#dmgStackTips":"<strong>Final DMG Bonus</strong> and <strong>F. P/M DMG BONUS</strong> are two <strong>different</strong> things! Look for it in your <strong>detailed stats</strong> where it shows as <strong>Final Damage Stack</strong> or <strong>Final Damage Bonus</strong>. Make sure you don't have any buffs active. Can't find it? Just set 0.","#targetRaceTips":"Specific MVP/MINi will <strong>auto sync and lock</strong> this option. Select <strong>Avg Lvl Boss</strong> if you want to target spesific race!","#targetAttrTips":"also same with race.","#dmgRaceTips":"Unlocked when target race selected, minimum valid value is 0.","#dmgAttrTips":"same condition with dmg to race","#mvpminiTips":"DUMMY have no defense stat. Avg 130, Necro, Ogre, Ktul defs less accurate than others!","#attackTips":"As you can see, it starts with 1, which is your attack. You can use the final result of this calculation to multiply with your attack (up to 99.5% accurate, <a href='#' class='job-sim' data-lightbox-gallery='my-gallery' data-lightbox-trigger>see this</a>).<br><br>But, dont expect to much! This tool calculates RNG buffs from equipment sets, flashes, and doesn't include flat or percentage damage bonuses.","#flashTips":"The values below are normalized to 100% uptime because both flashes only last 10 seconds on a 20 second cooldown.","#reaperTips":"Whether the elements match (+84% Final DMG Bonus) or differ (+28% Final DMG Bonus), the bonus doesn’t have 100% uptime since it only lasts 10 seconds with a 20-second cooldown, and the final result shown below represents the highest output during the buff’s active period.","#spearTips":"This bonus doesn't have 100% uptime because it only lasts 10 seconds while the cooldown is 20 seconds. The final result shown below represents the highest output during the buff's active period.","#elemCtrTips":"Tools assume target Neutral if you're not targeting any attribute.","#breakdownTips":"Values shown to two decimal places for readability. The final result is computed with full precision, so it may differ slightly if you recompute using the displayed (rounded) numbers.","#tableTips":"An upward arrow means higher than your stat, a square means roughly equal (\xb13%), and a downward means lower."});const SnackbarManager=(()=>{let e=null,t="snackbar-manager",a=()=>{e&&(clearTimeout(e),e=null),EventManager.removeNS(t),AppState.set("keyboardListenersAdded",!1)},r=e=>{if(!window.visualViewport)return;let a=()=>{let t=window.innerHeight-(window.visualViewport.height||window.innerHeight);e.style.bottom=`${80+t}px`};EventManager.addNS(t,window.visualViewport,"resize",a,{passive:!0}),EventManager.addNS(t,window.visualViewport,"scroll",a,{passive:!0})},l=e=>{let a=document.querySelector("input[type=number]");a&&(EventManager.addNS(t,a,"focusin",()=>e.style.bottom="300px"),EventManager.addNS(t,a,"focusout",()=>e.style.bottom="16px"))},i=e=>{!(window.innerWidth>480)&&(AppState.get("keyboardListenersAdded")||(AppState.set("keyboardListenersAdded",!0),window.visualViewport?r(e):l(e)))},n=t=>{let a=DOM_ELEMENTS?.snackbar;a&&t&&(a.textContent=t,e&&clearTimeout(e),a.classList.remove("show"),a.offsetHeight,a.classList.add("show"),i(a),e=setTimeout(()=>{a.classList.remove("show")},3e3))},s=()=>{window.innerWidth>480&&AppState.get("keyboardListenersAdded")&&a()};return EventManager.addNS(t,window,"resize",s,{passive:!0}),{show:n,cleanup:a,destroy:a}})(),showSnackbar=SnackbarManager.show,scrollAndFocusElement=(e,t)=>{t&&showSnackbar(t);let a=e.getBoundingClientRect().top+window.pageYOffset-80;return window.scrollTo({top:a,behavior:"smooth"}),e.disabled||e.focus({preventScroll:!0}),!1},accordionManager=(()=>{let e="max-height 320ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 320ms ease-out",t=new Map,a="accordion-manager",r=null,l=null,i=(e,t,a=1)=>{Object.assign(e.style,{maxHeight:t,opacity:a.toString()})},n=(e,t,r)=>{let l=!1,n=null,s=null,o=`${a}-${Date.now()}-${Math.random()}`,d=()=>{n&&(cancelAnimationFrame(n),n=null),null!==s&&(EventManager.remove(s),s=null),EventManager.removeNS(o),l=!1},c=()=>{e.setAttribute("open",""),i(r,"0px",.3),n=requestAnimationFrame(()=>{let e=r.scrollHeight+"px";i(r,e,1);let t=()=>{i(r,"none",1),l=!1,null!==s&&(EventManager.remove(s),s=null)};s=EventManager.add(r,"transitionend",t)})},u=()=>{let t=r.scrollHeight+"px";i(r,t,1),n=requestAnimationFrame(()=>{i(r,"0px",.3);let t=()=>{e.removeAttribute("open"),l=!1,null!==s&&(EventManager.remove(s),s=null)};s=EventManager.add(r,"transitionend",t)})},p=e=>{l||(l=!0,d(),e?c():u())},m=t=>{if(t.preventDefault(),l)return;let a=e.hasAttribute("open");p(!a)};return EventManager.addNS(o,t,"click",m),{animate:p,cleanup(){d(),EventManager.removeNS(o)},get isAnimating(){return l},namespace:o}},s=()=>{let e=[];t.forEach((t,a)=>{document.contains(a)||(t.cleanup(),e.push(a))}),e.forEach(e=>t.delete(e)),0===t.size&&l&&(clearInterval(l),l=null)},o=()=>{!l&&0!==t.size&&(l=setInterval(s,3e4))},d=e=>{let a=e.querySelector("summary"),r=e.querySelector(".body");if(!a||!r||t.has(e))return;let l=e.hasAttribute("open");Object.assign(r.style,{transition:"max-height 320ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 320ms ease-out",overflow:"hidden",maxHeight:l?"none":"0px",opacity:l?"1":"0.3"});let i=n(e,a,r);t.set(e,i)},c=()=>{s(),document.querySelectorAll("details").forEach(e=>{d(e)}),t.size>0&&o()},u=e=>{for(let t of e)if(0!==t.addedNodes.length){for(let a of t.addedNodes)if(1===a.nodeType&&("DETAILS"===a.tagName||a.querySelector?.("details")))return!0}return!1},p=e=>{for(let a of e)if(0!==a.removedNodes.length){for(let r of a.removedNodes)if(1===r.nodeType){if("DETAILS"===r.tagName&&t.has(r)){let l=t.get(r);l.cleanup(),t.delete(r);continue}r.querySelectorAll&&t.forEach((e,a)=>{r.contains(a)&&(e.cleanup(),t.delete(a))})}}};c(),(r=new MutationObserver(e=>{p(e),u(e)&&requestAnimationFrame(c)})).observe(document.body,{childList:!0,subtree:!0});let m=()=>{l&&(clearInterval(l),l=null),r&&(r.disconnect(),r=null),t.forEach(e=>e.cleanup()),t.clear()};return EventManager.addNS(a,window,"beforeunload",m),{destroy:m,reinitialize:c}})(),modalManager=(()=>{let{log:e,openLog:t,closeLog:a}=DOM_ELEMENTS||{};if(!e)return{show(){},hide(){},destroy(){}};let r=e.querySelector(".modal-content, .log-content, .modal-body")||e.firstElementChild,l="cubic-bezier(0.25, 0.8, 0.25, 1)",i="modal-manager",n={modal:{display:"none",transition:`opacity 280ms ${l}, transform 280ms ${l}, backdrop-filter 280ms ${l}`,transformOrigin:"center"},content:r?{transition:`transform 280ms ${l}, opacity 280ms ${l}`}:null};Object.assign(e.style,n.modal),r&&Object.assign(r.style,n.content);let s=!1,o=null,d=null,c=()=>{o&&(cancelAnimationFrame(o),o=null),d&&(clearTimeout(d),d=null)},u=()=>{Object.assign(e.style,{opacity:"0",transform:"scale(0.96)",backdropFilter:"blur(0px)",backgroundColor:"transparent"}),r&&Object.assign(r.style,{transform:"translateY(-8px) scale(0.98)",opacity:"0.5"})},p=()=>{Object.assign(e.style,{opacity:"1",transform:"scale(1)",backdropFilter:"blur(6px)",backgroundColor:"rgba(0, 0, 0, 0.3)"}),r&&Object.assign(r.style,{transform:"translateY(0) scale(1)",opacity:"1"})},m=()=>{s&&(s=!1,c(),u(),d=setTimeout(()=>{s||(e.style.display="none")},280))},g=()=>{s||(s=!0,c(),e.style.display="flex",o=requestAnimationFrame(()=>{p()}))},h=e=>{e.stopPropagation(),g()},$=e=>{"Escape"===e.key&&s&&m()},b=e=>{!(!s||!r||r.contains(e.target))&&e.target!==t&&m()};EventManager.addNS(i,t,"click",h),EventManager.addNS(i,a,"click",m),EventManager.addNS(i,document,"keydown",$),EventManager.addNS(i,document,"click",b);let M=()=>{c(),EventManager.removeNS(i)};return EventManager.addNS(i,window,"beforeunload",M),{show:g,hide:m,destroy:M}})();class DropdownManager{constructor(){this.constants={formKeys:["vesperSet","whiteSet","blueSet","tRace","tAttr","atkType","wElem","tSize","tDef","weapon","pen","crit"],mobMapping:{sizeMob:"tSize",raceMob:"tRace",attributeMob:"tAttr"},disableButtons:["resetAll","resetRek","testSpear","testReaper"],relatedFields:{tSize:"sizeEnh",tRace:"race",tAttr:"attr"},calcFields:["dmg","dmgStack","sizeEnh","race","attr","elemEnh"],setKeys:["blueSet","vesperSet","whiteSet"]},this.config=this.buildConfig(),this.state={selectionOrder:[],lockStates:new Map,isSwapping:!1,updateTimer:null},this.namespace="dropdown-manager",this.isInitialized=!1,this.init()}buildConfig(){return{...this.constants,labels:{static:{blueSetLabel:"Blue SET",vesperSetLabel:"Vesper SET",whiteSetLabel:"White SET (110*3)",atkTypeLabel:"Attack Type",weaponLabel:"Weapon",wElemLabel:"Weapon Element",tSizeLabel:"Target Size",tRaceLabel:"Target Race",tAttrLabel:"Target Attribute",tDefLabel:"MVP/MINI",penLabel:"P/M PEN %",critLabel:"Critical DMG Bonus %",elemEnhLabel:"Element Enhance %",sizeLabel:"DMG to Size %",raceLabel:"Race",attrLabel:"Attribute",dmgLabel:"Final P/M Damage Bonus %",dmgStackLabel:"Extra: Final Damage Stack %"},dynamic:{vesper:{48:"BRO?!",56:"REALY?!",64:"Wake UP!",72:"STOP Dreaming!",80:"F2P DETECTED!"},white:{36:"Eh?",42:"WOW",48:"GG!!",54:"Have a Nice Day!"}}},fields:{atkType:{type:"dropdown",options:[{value:"pen",label:"P/M PEN"},{value:"crit",label:"CRIT"}],placeholder:"Select Attack Type",onClear:["pen","crit"],onUpdate:"updateAttackTypeUI"},tSize:{type:"dropdown",options:["Small","Medium","Large"],placeholder:"Select Target Size"},tRace:{type:"dropdown",options:()=>RACE_TYPES,placeholder:"skip race",onClear:["race"]},tAttr:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"skip attribute",onClear:["attr"]},weapon:{type:"dropdown",options:()=>Object.keys(getWeaponSizeModifier()),placeholder:"Select Weapon Type"},wElem:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"Select Attribute"},tDef:{type:"dropdown",options:()=>Object.keys(getTargetDefenseData()),placeholder:"Select target",special:"target"},vesperSet:{type:"set",generator:"vesper"},whiteSet:{type:"set",generator:"white"},blueSet:{type:"set",generator:"blue"},race:{type:"conditional",dependsOn:"tRace",active:e=>({label:`DMG to ${e}`,placeholder:`dmg to ${e.toLowerCase()} %`}),default:{label:"Race",placeholder:"select target race first"}},attr:{type:"conditional",dependsOn:"tAttr",active:e=>({label:`DMG to ${e} Attribute`,placeholder:`dmg to ${e.toLowerCase()} attribute %`}),default:{label:"Attribute",placeholder:"select target attribute first"}},elemEnh:{type:"conditional",dependsOn:"wElem",active:e=>({label:`${e} Enhance %`,placeholder:`${e.toLowerCase()} enhance`}),default:{label:"Element Enhance %",placeholder:"select weapon attribute first"}},sizeEnh:{type:"conditional",dependsOn:"tSize",active:e=>({label:`DMG to ${e} %`,placeholder:`dmg to ${e.toLowerCase()}`}),default:{label:"DMG to Size %",placeholder:"select target size first"}},dmg:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final p/m damage bonus"}),default:{placeholder:"select attack type first"}},dmgStack:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final damage bonus/stack %"}),default:{placeholder:"select attack type first"}}},setGenerators:{vesper:()=>[{value:"",label:"skip vesper set"},...Object.entries(VESPER_SET).map(([e,t])=>({value:t,label:`Tier ${e}`}))],white:()=>[{value:"",label:"skip white set"},...Object.entries(WHITE_SET).map(([e,t])=>({value:t,label:e}))],blue:()=>[{value:"",label:"skip blue set"},...Object.entries(BLUE_SET).flatMap(([e,t])=>Object.entries(t).map(([t,a])=>({value:a,label:`Level ${t}*${e}`})))]},eventMap:{penCritSelect:"atkType",weaponSelect:"weapon",weaponElementSelect:"wElem",targetSizeSelect:"tSize",targetRaceSelect:"tRace",targetElementSelect:"tAttr"}}}init(){this.isInitialized||(this.populateAllDropdowns(),this.bindEvents(),this.updateAll(),this.syncThreeSets(),this.isInitialized=!0)}getFormData(){return this.config.formKeys.reduce((e,t)=>{let a=DOM_ELEMENTS[t];return a&&(e[t]=a.value||"","SELECT"===a.tagName&&a.selectedOptions[0]&&(e[`${t}Text`]=a.selectedOptions[0].textContent)),e},{})}getTargetData(e){if(!e)return null;let t=getTargetDefenseData(e);return t?{...t,sizeMob:t.sizeMob||DOM_ELEMENTS.tSize?.value||""}:null}getCurrentTarget(){let e=DOM_ELEMENTS.tDef?.value;return e?{key:e,data:this.getTargetData(e)}:null}populateAllDropdowns(){Object.entries(this.config.fields).forEach(([e,t])=>{if("dropdown"!==t.type&&"set"!==t.type)return;let a=DOM_ELEMENTS[e];if(!a)return;let r=t.generator?this.config.setGenerators[t.generator]():"function"==typeof t.options?t.options():t.options;this.populateOptions(a,r,t.placeholder)})}populateOptions(e,t,a){if(!e)return;let r=document.createDocumentFragment();if(a){let l=document.createElement("option");l.value="",l.textContent=a,r.appendChild(l)}t.forEach(e=>{let t=document.createElement("option"),a="string"==typeof e;t.value=a?e:e.value,t.textContent=a?e:e.label,e.disabled&&(t.disabled=!0),r.appendChild(t)}),e.innerHTML="",e.appendChild(r)}setFieldState(e,t,a="",r=""){if(!e)return;e.disabled=t,e.placeholder=t?r:a;let l=e.closest(".input-wrap");l&&(l.classList.toggle("locked",t),t||l.removeAttribute("data-temp-unlocked"))}clearFields(e){e.forEach(e=>{let t=DOM_ELEMENTS[e];t&&(t.value="")})}applyMobProperties(e,t="standard",a=null){e&&Object.entries(this.config.mobMapping).forEach(([r,l])=>{let i=DOM_ELEMENTS[l];if(!i)return;let n=e[r],s=this.shouldLock(l,n,t,a);i.value=n||"",i.disabled=s,this.state.lockStates.set(l,s);let o=i.closest(".input-wrap");if(o&&o.classList.toggle("locked",s),!n){let d=this.config.relatedFields[l],c=d?DOM_ELEMENTS[d]:null;if(c){c.value="";let u=c.closest(".input-wrap");u&&(u.classList.remove("locked"),u.setAttribute("data-temp-unlocked","1"))}}})}shouldLock(e,t,a,r){if(null!==r)return r;let l=DOM_ELEMENTS.tDef?.value||"";return"swap"===a?!!t:t&&!l.includes("Lvl.")}bindEvents(){EventManager.removeNS(this.namespace),EventManager.addNS(this.namespace,document,"change",e=>{if(AppState.get("isResultShown"))return;if(e.target===DOM_ELEMENTS.tDef){this.handleTargetChange();return}if(this.constants.setKeys.includes(e.target.id)){this.recordSelection(e.target),this.syncThreeSets(),this.scheduleUpdate();return}let t=this.config.eventMap[e.target.id];if(t){let a=this.config.fields[t];a?.onClear&&this.clearFields(a.onClear),a?.onUpdate==="updateAttackTypeUI"&&this.updateAttackTypeUI(),this.scheduleUpdate()}})}handleTargetChange(){if(this.state.isSwapping)return;let e=DOM_ELEMENTS.tDef?.value;if(!e)return;let t=this.getTargetData(e);t&&(this.applyMobProperties(t),this.syncBreakdownSwap(e),this.scheduleUpdate())}recordSelection(e){let t=this.getFormData(),a=this.state.selectionOrder.length>=3||t.blueSet&&(t.blueSetText||"").includes("*8");if(!e?.value){this.state.selectionOrder=this.state.selectionOrder.filter(t=>t!==e);return}this.state.selectionOrder=a?[e]:this.state.selectionOrder.includes(e)?this.state.selectionOrder:[...this.state.selectionOrder,e]}syncThreeSets(){let e=this.constants.setKeys.map(e=>DOM_ELEMENTS[e]).filter(Boolean),t=this.getFormData(),a=(t.blueSetText||"").includes("*8"),r=t.blueSet&&a;if(e.forEach(e=>Array.from(e.options).forEach(e=>e.disabled=!1)),r)[DOM_ELEMENTS.vesperSet,DOM_ELEMENTS.whiteSet].forEach(e=>{e&&(Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value="")});else{this.state.selectionOrder.length>0&&DOM_ELEMENTS.blueSet&&Array.from(DOM_ELEMENTS.blueSet.options).forEach(e=>{e.value&&e.textContent.includes("*8")&&(e.disabled=!0)}),this.state.selectionOrder.length>=2&&e.filter(e=>!this.state.selectionOrder.includes(e)).forEach(e=>{Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value=""});let l=DOM_ELEMENTS.blueSet;l?.value&&l.selectedOptions[0]?.disabled&&(l.value="",this.state.selectionOrder=this.state.selectionOrder.filter(e=>e!==l))}}updateAll(){let e=this.getFormData();this.updateStaticLabels(),this.updateDynamicLabels(e),this.updateConditionalFields(e),this.updateAttackTypeUI()}updateStaticLabels(){Object.entries(this.config.labels.static).forEach(([e,t])=>{let a=DOM_ELEMENTS[e];a&&(a.textContent=t)})}updateDynamicLabels(e){let t=DOM_ELEMENTS.vesperSetLabel,a=DOM_ELEMENTS.whiteSetLabel;t&&(t.textContent=this.config.labels.dynamic.vesper[e.vesperSet]||"Vesper SET"),a&&(a.textContent=this.config.labels.dynamic.white[e.whiteSet]||"White SET (110*3)")}updateConditionalFields(e){Object.entries(this.config.fields).forEach(([t,a])=>{if("conditional"!==a.type)return;let r=DOM_ELEMENTS[t],l=DOM_ELEMENTS[`${t}Label`],i=e[a.dependsOn];if(!r||!a.active||!a.default)return;let n=i?a.active(i):a.default;r.disabled=!i,r.placeholder=n.placeholder,l&&n.label&&(l.textContent=n.label)})}updateAttackTypeUI(){let e=this.getFormData().atkType,t=document.querySelector(".form-group.pen-group"),a=document.querySelector(".form-group.crit-group");[t,a].forEach(e=>e?.classList.add("hidden")),"pen"===e&&t?(t.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.pen,!1,"total converted raw pen + final pen..."),this.setFieldState(DOM_ELEMENTS.crit,!0)):"crit"===e&&a?(a.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.crit,!1,"critical damage bonus..."),this.setFieldState(DOM_ELEMENTS.pen,!0)):(this.setFieldState(DOM_ELEMENTS.pen,!0),this.setFieldState(DOM_ELEMENTS.crit,!0))}scheduleUpdate(){this.state.updateTimer&&clearTimeout(this.state.updateTimer),this.state.updateTimer=setTimeout(()=>{this.updateAll(),this.state.updateTimer=null},50)}determineSwapMode(e,t){if(!e||!t||t===e)return"none";let a=this.getTargetData(e),r=this.getTargetData(t);if(!a||!r)return"manual";let l=getTargetDefenseData(e)||{},i=getTargetDefenseData(t)||{},n={sizeMob:DOM_ELEMENTS.tSize?.value||"",raceMob:DOM_ELEMENTS.tRace?.value||"",attributeMob:DOM_ELEMENTS.tAttr?.value||""};for(let[s]of Object.entries(this.config.mobMapping)){let o=l[s],d=i[s];if(o&&d&&o!==d||d&&!o&&("sizeMob"!==s||n.sizeMob!==d))return"manual"}return"auto"}executeSwap(e,t,a){let r=this.determineSwapMode(this.getCurrentTarget()?.key,e);if("none"===r)return;this.state.isSwapping=!0,DOM_ELEMENTS.tDef&&(DOM_ELEMENTS.tDef.value=e),this.syncBreakdownSwap(e),this.resetGlobalStates();let l=this.getTargetData(e);if(!l){this.state.isSwapping=!1;return}"auto"===r?(this.applyMobProperties(l,"swap"),"function"==typeof processMainCalculation&&processMainCalculation(),"function"==typeof showSnackbar&&showSnackbar("Auto calc triggered!"),this.scheduleUpdate()):(this.unlockCalculationFields(a),this.applyMobProperties(l,"manual",!0),this.updateManualSwapUI(t,a),this.scheduleUpdate()),this.state.isSwapping=!1}unlockCalculationFields(e){let t=[...this.config.calcFields,e?"pen":"crit"];t.forEach(e=>{let t=DOM_ELEMENTS[e];if(!t)return;let a=t.closest(".input-wrap");a?.querySelector('input[type="number"]')&&(a.classList.remove("locked"),a.dataset.tempUnlocked="1"),t.disabled=!1}),"function"==typeof unbindInputLockGuard&&unbindInputLockGuard()}updateManualSwapUI(e,t){DOM_ELEMENTS.submit&&(DOM_ELEMENTS.submit.disabled=!1),this.config.disableButtons.forEach(e=>{let t=DOM_ELEMENTS[e];t&&(t.disabled=!0)}),DOM_ELEMENTS.hasil&&(DOM_ELEMENTS.hasil.dataset.specificMode="0",DOM_ELEMENTS.hasil.textContent="Input your stats to see the result..."),DOM_ELEMENTS.rec&&(DOM_ELEMENTS.rec.textContent="Balancing stat recommendations for a higher output multiplier.");let a=t?DOM_ELEMENTS.pen:DOM_ELEMENTS.crit;"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(a,"Target swapped - please verify stats and recalculate!"),"function"==typeof validateRequiredFields&&validateRequiredFields(),"function"==typeof validateStatsVsTarget&&validateStatsVsTarget(e)}syncBreakdownSwap(e){let t=document.querySelector("#breakdown-swap");t&&t.value!==e&&(t.value=e)}resetGlobalStates(){AppState.reset(),["testSpear","testReaper"].forEach(e=>{let t=DOM_ELEMENTS[e];t&&t.classList.remove("activated")})}createSwapSelect(e,t){let a=document.createElement("select");a.id="breakdown-swap",a.className="breakdown-swap";let r=+e.pen,l=+e.dmg,i=this.getCurrentTarget()?.key,n=getTargetDefenseData(),s=Object.keys(n).map(e=>{let a=n[e],s=+(a?.def||0),o=+(a?.dmgred||0),d=this.determineSwapMode(i,e),c="auto"===d&&(l<=o||t&&r<=s),u=c?`${e} (cant auto calc)`:e;return`<option value="${e}"${c?" disabled":""}>${u}</option>`});return a.innerHTML=s.join(""),a.value=e.tDefKey||"DUMMY",a.hasAttribute("data-dropdown-bound")||(EventManager.addNS(this.namespace,a,"change",()=>this.executeSwap(a.value,e,t)),a.setAttribute("data-dropdown-bound","true")),a}destroy(){this.state.updateTimer&&(clearTimeout(this.state.updateTimer),this.state.updateTimer=null),EventManager.removeNS(this.namespace),this.state.selectionOrder=[],this.state.lockStates.clear(),this.state.isSwapping=!1,this.isInitialized=!1}}const dropdownManager=new DropdownManager;class ValidationSSoT{constructor(){this.INVALID_CLASS="invalid-value",this.touchedFields=new Set,this.snackbarCooldowns=new Set,this.namespace="validation-ssot",this.isInitialized=!1,this.autoInit()}isPenOrDmg=e=>["pen","dmg"].includes(e?.id);isRelatedNumeric=e=>["race","attr"].includes(e?.id);isNumeric=e=>e?.type==="number"||e?.classList.contains("numeric-input")||this.isPenOrDmg(e)||this.isRelatedNumeric(e);isValidNumber=e=>!isNaN(+e)&&isFinite(+e);normalizeInput=e=>String(e).replace(/[^\d.,]/g,"").replace(/,/g,".").replace(/\.{2,}/g,".").replace(/^\./,"0.").replace(/\.$/,"");showMessage=e=>"function"==typeof showSnackbar&&showSnackbar(e);canShowSnackbar(e){return!this.snackbarCooldowns.has(e)&&(this.snackbarCooldowns.add(e),setTimeout(()=>this.snackbarCooldowns.delete(e),2e3),!0)}getDropdownForRelated(e){return"race"===e.id?DOM_ELEMENTS.tRace:DOM_ELEMENTS.tAttr}validateRelatedNumeric(e,t){let a=this.getDropdownForRelated(e);return a?.value||t?a?.value&&!t?{isValid:!1,reason:"related_required"}:null:{isValid:!0,reason:"related_empty"}}validateMinValue(e,t,a){let r=e.getAttribute("min");if(null===r||""===r)return null;let l=+r;if(t>=l)return null;if(a&&this.canShowSnackbar(e.id)){let i=e.getAttribute("data-field-name")||e.id||"Field";this.showMessage(`${i} must be at least ${l}`)}return{isValid:!1,reason:"below_min"}}validateMaxValue(e,t,a){let r=e.getAttribute("max");return null===r||""===r?null:t<=+r?null:(a&&this.canShowSnackbar(e.id)&&this.showMessage("what are you doing?"),{isValid:!1,reason:"above_max"})}validateThreshold(e,t,a){if(!this.isPenOrDmg(e))return null;let r=getTargetDefenseData(DOM_ELEMENTS.tDef?.value),l="pen"===e.id?+r?.def||0:+r?.dmgred||0;if(t>l)return null;if(a&&this.canShowSnackbar(e.id)){let i=(l+8).toFixed(2),n="pen"===e.id?"Final PEN":"Final P/M Bonus",s=DOM_ELEMENTS.tDef?.options?.[DOM_ELEMENTS.tDef.selectedIndex]?.textContent||"target";this.showMessage(`Need at least ${i} ${n} vs ${s}`)}return{isValid:!1,reason:"threshold_not_met"}}validateField(e,t=!1){let a=e.value?.trim()||"";if(this.isRelatedNumeric(e)){let r=this.validateRelatedNumeric(e,a);if(r)return r}if(!a)return{isValid:!1,reason:"empty"};if(this.isNumeric(e)&&!this.isValidNumber(a))return{isValid:!1,reason:"invalid_number"};let l=+a,i=this.validateMinValue(e,l,t);if(i)return i;let n=this.validateMaxValue(e,l,t);if(n)return n;let s=this.validateThreshold(e,l,t);return s||{isValid:!0}}updateFieldState(e,t){this.touchedFields.has(e.id)&&e.classList.toggle(this.INVALID_CLASS,!t)}normalizeElement(e){if(!e||!this.isNumeric(e))return;let t=this.normalizeInput(e.value);t!==e.value&&(e.value=t);let a=this.validateField(e,this.touchedFields.has(e.id));this.updateFieldState(e,a.isValid)}createValidateHandler(e){return (t=!1)=>{let a=this.validateField(e,t);this.updateFieldState(e,a.isValid)}}createNormalizeHandler(e){return()=>{if(!this.isNumeric(e))return;let t=this.normalizeInput(e.value);t!==e.value&&(e.value=t)}}setupField(e){let t=this.createValidateHandler(e),a=this.createNormalizeHandler(e);EventManager.addNS(this.namespace,e,"focus",()=>{this.touchedFields.add(e.id)}),EventManager.addNS(this.namespace,e,"input",()=>{a(),t(!1)}),EventManager.addNS(this.namespace,e,"blur",()=>t(!0)),EventManager.addNS(this.namespace,e,"change",()=>t(!0)),EventManager.addNS(this.namespace,e,"paste",()=>{this.isNumeric(e)&&setTimeout(()=>this.normalizeElement(e),0)})}setupDefenseChangeHandler(){DOM_ELEMENTS.tDef&&EventManager.addNS(this.namespace,DOM_ELEMENTS.tDef,"change",()=>{[DOM_ELEMENTS.pen,DOM_ELEMENTS.dmg].filter(e=>e?.value.trim()).forEach(e=>{let t=this.validateField(e,this.canShowSnackbar(e.id));this.updateFieldState(e,t.isValid)})})}checkReady=()=>void 0!==DOM_ELEMENTS&&DOM_ELEMENTS;init(){return!this.isInitialized&&!!this.checkReady()&&(["atkType","weapon","wElem","tDef","tSize","pen","crit","dmg","elemEnh","sizeEnh","race","attr","dmgStack"].map(e=>DOM_ELEMENTS[e]).filter(Boolean).forEach(e=>this.setupField(e)),this.setupDefenseChangeHandler(),this.isInitialized=!0,!0)}autoInit(){if(this.isInitialized)return;let e=()=>{this.isInitialized||this.init()};"loading"===document.readyState||"interactive"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):this.init(),window.addEventListener("load",e,{once:!0})}getRequiredFields(){return[{el:DOM_ELEMENTS.atkType,name:"Attack Type"},{el:DOM_ELEMENTS.weapon,name:"Weapon Type"},{el:DOM_ELEMENTS.wElem,name:"Weapon Attribute"},{el:DOM_ELEMENTS.tDef,name:"Target Boss"},{el:DOM_ELEMENTS.tSize,name:"Target Size"},{el:DOM_ELEMENTS.pen,name:"Final P M PEN %",condition:()=>DOM_ELEMENTS.atkType?.value==="pen"},{el:DOM_ELEMENTS.crit,name:"Critical DMG Bonus %",condition:()=>DOM_ELEMENTS.atkType?.value==="crit"},{el:DOM_ELEMENTS.dmg,name:"Final P M DMG Bonus %"},{el:DOM_ELEMENTS.elemEnh,name:"Element Enhance %"},{el:DOM_ELEMENTS.sizeEnh,name:"DMG to Size %"},{el:DOM_ELEMENTS.race,name:"DMG to Race %",condition:()=>DOM_ELEMENTS.race&&!DOM_ELEMENTS.race.disabled},{el:DOM_ELEMENTS.attr,name:"DMG to Attribute %",condition:()=>DOM_ELEMENTS.attr&&!DOM_ELEMENTS.attr.disabled},{el:DOM_ELEMENTS.dmgStack,name:"Final DMG Bonus %"}]}shouldValidateField(e){return!!e.el&&(!e.condition||e.condition())}validateSingleField(e){this.touchedFields.add(e.el.id);let t=this.validateField(e.el,this.canShowSnackbar(e.el.id));return this.updateFieldState(e.el,t.isValid),!!t.isValid||("function"==typeof scrollAndFocusElement&&scrollAndFocusElement(e.el),!1)}validateAllRequired(){let e=this.getRequiredFields();for(let t of e)if(this.shouldValidateField(t)&&!this.validateSingleField(t))return!1;return!0}getStatsElements(e){let t=[];return"pen"===e?.atkType?.toLowerCase()&&DOM_ELEMENTS.pen&&t.push(DOM_ELEMENTS.pen),DOM_ELEMENTS.dmg&&t.push(DOM_ELEMENTS.dmg),t}shouldFocusElement(e,t){return t===e||!t}validateStatsElement(e,t){this.touchedFields.add(e.id);let a=this.validateField(e,this.canShowSnackbar(e.id));return this.updateFieldState(e,a.isValid),!(!a.isValid&&this.shouldFocusElement(e,t))||("function"==typeof scrollAndFocusElement&&scrollAndFocusElement(e),!1)}validateStats(e,t=null){let a=this.getStatsElements(e);for(let r of a)if(!this.validateStatsElement(r,t))return!1;return!0}destroy(){EventManager.removeNS(this.namespace),this.touchedFields.clear(),this.snackbarCooldowns.clear(),this.isInitialized=!1}}const ValidationSSoTInstance=new ValidationSSoT,normalizeNumericInput=(e,t)=>{e&&(void 0!==t&&(e.value=t),ValidationSSoTInstance.normalizeElement(e))},validateRequiredFields=()=>ValidationSSoTInstance.validateAllRequired(),validateStatsVsTarget=(e,t=null)=>ValidationSSoTInstance.validateStats(e,t),InputLockManager=(()=>{let e=(()=>{let e=!1;try{let t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(a){}return e})(),t="PointerEvent"in window,a=!!e&&{passive:!1},r=null,l=!1,i=null,n=new Map,s=new WeakMap,o=()=>{l=!1,r=null},d=()=>(l&&r||(r=Array.from(document.querySelectorAll(".input-wrap")),l=!0),r),c=()=>{i||"undefined"==typeof MutationObserver||(i=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){for(let a of[...t.addedNodes,...t.removedNodes])if(1===a.nodeType&&(a.classList?.contains("input-wrap")||a.querySelector?.(".input-wrap"))){o();return}}})).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"]})},u=()=>{i&&(i.disconnect(),i=null)},p=e=>{let t=e?.currentTarget;if(!t?.classList?.contains("locked"))return;let a=Date.now(),r=s.get(t);r&&a-r<500||(s.set(t,a),e?.cancelable&&(e.preventDefault(),e.stopPropagation()),(!window._lastSnackbarTime||a-window._lastSnackbarTime>3e3)&&(window._lastSnackbarTime=a,"function"==typeof showSnackbar&&showSnackbar("Your Stats Locked!")))},m=e=>{if(!e?.nodeType||n.has(e))return;let r=t?[EventManager.add(e,"pointerdown",p,a)]:[EventManager.add(e,"touchstart",p,a),EventManager.add(e,"click",p,!1)];n.set(e,r)},g=e=>{if(!e?.nodeType)return;let t=n.get(e);t&&(t.forEach(e=>EventManager.remove(e)),n.delete(e),s.delete(e))},h=()=>{c();let e=d();for(let t=0;t<e.length;t++){let a=e[t],r=a.querySelectorAll("input, select, textarea");if(r.length){for(let l=0;l<r.length;l++)r[l].disabled=!0;a.classList.add("locked"),m(a)}}},$=()=>{let e=d();for(let t=0;t<e.length;t++){let a=e[t],r=a.querySelectorAll("input, select, textarea");if(r.length){for(let l=0;l<r.length;l++)r[l].disabled=!1;a.classList.remove("locked"),g(a)}}o(),u()},b=()=>{u(),n.forEach(e=>e.forEach(e=>EventManager.remove(e))),n.clear(),o()};return{bind:m,unbind:g,lockAll:h,unlockAll:$,destroy:b}})(),bindInputLockGuard=InputLockManager.bind,unbindInputLockGuard=InputLockManager.unbind,lockAllInputs=InputLockManager.lockAll,unlockAllInputs=InputLockManager.unlockAll;class StickyHandler{constructor(){this.state={isActive:!1,isCollapsed:!1,isMobile:!1,animating:!1},this.config={MOBILE_BREAKPOINT:480,BUTTON_HEIGHT:56,ANIMATION_DELAY:60,TRANSITION_DURATION:300,DOM_REINJECT_DELAY:50,OBSERVER_DEBOUNCE:16,RESIZE_DEBOUNCE:100,CLEANUP_DELAY:320},this.selectors={resetRek:"resetRekomenBtn",resetAll:"resetAllBtn",swapBoss:"breakdown-swap",stickyStart:()=>DOM_ELEMENTS?.hasil,testSpear:()=>DOM_ELEMENTS?.testSpear,testReaper:()=>DOM_ELEMENTS?.testReaper},this.buttonOrder=["toggleBtn","swapBoss","testSpear","testReaper","resetRek","resetAll","backBtn"],this.textButtons=new Set(["resetRek","resetAll","testSpear","testReaper"]),this.controlButtons=[{id:"toggleStickyBtn",class:"sticky-toggle",key:"toggleBtn",handler:"handleToggle"},{id:"backToHasilBtn",class:"sticky-back",key:"backBtn",handler:"handleBack"}],this.elements=new Map,this.timeouts=new Map,this.boundListeners=new Map,this.scrollRAF=null,this.observer=null,this.unsubscribeAppState=null,this.initialized=!1,this.init()}canOperate(){return this.state.isMobile&&AppState.get("isResultShown")&&this.state.isActive}initElements(){for(let[e,t]of(this.elements.clear(),Object.entries(this.selectors))){let a="function"==typeof t?t():document.getElementById(t);a&&(this.elements.set(e,a),this.textButtons.has(e)&&!a.dataset.originalText&&(a.dataset.originalText=a.textContent.trim()||""),"swapBoss"===e&&this.state.isActive&&this.state.isMobile&&(a.dataset.stickyPreserve="true"))}this.createControlButtons()}createControlButtons(){for(let{id:e,class:t,key:a,handler:r}of this.controlButtons){let l=document.getElementById(e);if(l||((l=document.createElement("button")).id=e,l.className=t,document.body.appendChild(l)),this.elements.set(a,l),!l.dataset.bound){let i=e=>this[r](e);l.addEventListener("click",i),l.dataset.bound="true",this.boundListeners.set(`button-${a}`,{target:l,event:"click",handler:i})}}let n=this.elements.get("toggleBtn");n&&(n.dataset.collapse="false")}getOrderedButtons(){let e=[];for(let t of this.buttonOrder){let a=this.elements.get(t);a&&e.push(a)}return e}handleToggle=e=>{if(e.preventDefault(),!this.canOperate()||this.state.animating)return;this.state.animating=!0,this.state.isCollapsed=!this.state.isCollapsed;let t=this.elements.get("toggleBtn");t&&(t.dataset.collapse=String(this.state.isCollapsed)),navigator.vibrate&&navigator.vibrate(50),this.applySticky(),this.scheduleTimeout("animationEnd",()=>{this.state.animating=!1},this.config.TRANSITION_DURATION)};handleBack=e=>{if(e.preventDefault(),!this.canOperate())return;let t=this.elements.get("stickyStart");t&&t.scrollIntoView({behavior:"smooth",block:"start"})};handleScroll=()=>{this.scrollRAF||(this.scrollRAF=requestAnimationFrame(()=>{this.updateSticky(),this.scrollRAF=null}))};handleResize=()=>{this.scheduleTimeout("resize",this.updateSticky.bind(this),this.config.RESIZE_DEBOUNCE)};scheduleTimeout(e,t,a){let r=this.timeouts.get(e);r&&clearTimeout(r),this.timeouts.set(e,setTimeout(t,a))}clearAllTimeouts(){for(let e of this.timeouts.values())clearTimeout(e);this.timeouts.clear()}updateMobileState(){let e=window.innerWidth<=this.config.MOBILE_BREAKPOINT,t=e!==this.state.isMobile;return this.state.isMobile=e,t}deactivateSticky(){this.state.isActive=!1,this.state.isCollapsed=!1,this.removeSticky()}updateSticky(){let e=this.updateMobileState();if(!this.state.isMobile){(e||this.state.isActive)&&this.deactivateSticky();return}if(!AppState.get("isResultShown")){this.state.isActive&&this.deactivateSticky();return}let t=this.elements.get("stickyStart");if(!t)return;let a=t.getBoundingClientRect().top<=0;a!==this.state.isActive&&(this.state.isActive=a,a?this.applySticky():this.removeSticky())}applySticky(){if(!this.canOperate())return;let e=this.getOrderedButtons();if(0===e.length)return;let t=e[0].classList.contains("sticky"),a=this.elements.get("toggleBtn");for(let r=0;r<e.length;r++){let l=e[r],i=l===a,n=this.state.isCollapsed?0:-(r*this.config.BUTTON_HEIGHT),s=this.state.isCollapsed&&!i?"0.4":"1";l.classList.add("sticky"),l.classList.toggle("collapsed",this.state.isCollapsed),t?this.setButtonStyle(l,n,s):this.animateButtonIn(l,r,n)}this.scheduleTimeout("textUpdate",this.updateButtonText.bind(this),0)}animateButtonIn(e,t,a){this.setButtonStyle(e,50,0,"none"),this.scheduleTimeout(`buttonIn-${t}`,()=>{this.setButtonStyle(e,a,1,"all 400ms cubic-bezier(0.34, 1.56, 0.64, 1)")},t*this.config.ANIMATION_DELAY)}setButtonStyle(e,t,a,r=""){e.style.cssText=`transform:translate3d(0,${t}px,0);opacity:${a};${r?`transition:${r};`:""}`}removeSticky(){let e=this.getOrderedButtons();if(0!==e.length){for(let t of e)t.classList.contains("sticky")&&this.setButtonStyle(t,0,.3,"transform 300ms ease,opacity 200ms ease");this.scheduleTimeout("cleanup",()=>this.cleanupSticky(e),this.config.CLEANUP_DELAY)}}cleanupSticky(e){for(let t of e)t.classList.remove("sticky","collapsed"),t.style.cssText="",t.dataset.originalText&&(t.textContent=t.dataset.originalText)}updateButtonText(){for(let e of this.textButtons){let t=this.elements.get(e);t&&(t.textContent=this.state.isActive?"":t.dataset.originalText||"")}}preserveSwapState(){let e=this.elements.get("swapBoss");if(!e||"SELECT"!==e.tagName)return null;let t=window.getComputedStyle(e);return{value:e.value,transform:t.transform,opacity:t.opacity,isSticky:e.classList.contains("sticky"),isCollapsed:e.classList.contains("collapsed")}}restoreSwapState(e){if(!e)return;let t=this.elements.get("swapBoss");t&&"SELECT"===t.tagName&&(e.value&&(t.value=e.value),t.style.cssText=`transform:${e.transform};opacity:${e.opacity};transition:none;`,e.isSticky&&t.classList.add("sticky"),e.isCollapsed&&t.classList.add("collapsed"))}setupEventListeners(){let e=[["scroll",this.handleScroll],["resize",this.handleResize]];for(let[t,a]of e){let r=`window-${t}`;this.boundListeners.has(r)||(window.addEventListener(t,a,{passive:!0}),this.boundListeners.set(r,{target:window,event:t,handler:a}))}}removeEventListeners(){for(let{target:e,event:t,handler:a}of this.boundListeners.values())e.removeEventListener(t,a);this.boundListeners.clear()}setupDOMObserver(){"undefined"==typeof MutationObserver||this.observer||(this.observer=new MutationObserver(e=>{let t=!1;for(let a of e){for(let r of a.addedNodes)if("breakdown-swap"===r.id||1===r.nodeType&&r.querySelector?.("#breakdown-swap")){t=!0;break}if(t)break}if(!t){this.scheduleTimeout("observer",this.updateSticky.bind(this),this.config.OBSERVER_DEBOUNCE);return}this.scheduleTimeout("observer",()=>{let e=this.preserveSwapState();this.initElements(),this.canOperate()?(e&&this.restoreSwapState(e),this.scheduleTimeout("domReinject",this.applySticky.bind(this),this.config.DOM_REINJECT_DELAY)):this.updateSticky()},this.config.OBSERVER_DEBOUNCE)}),this.observer.observe(document.body,{childList:!0,subtree:!0}))}setupAppStateSubscription(){this.unsubscribeAppState=AppState.subscribe((e,t)=>{"isResultShown"===e&&(!t&&this.state.isActive?this.deactivateSticky():t&&this.state.isMobile&&!this.state.isActive&&this.updateSticky())})}init(){let e=()=>{this.initialized||(this.initElements(),this.setupEventListeners(),this.setupDOMObserver(),this.setupAppStateSubscription(),this.updateSticky(),this.initialized=!0)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()}destroy(){this.clearAllTimeouts(),this.scrollRAF&&(cancelAnimationFrame(this.scrollRAF),this.scrollRAF=null),this.removeEventListeners(),this.observer&&(this.observer.disconnect(),this.observer=null),this.unsubscribeAppState&&(this.unsubscribeAppState(),this.unsubscribeAppState=null),this.elements.clear(),this.boundListeners.clear(),this.timeouts.clear(),this.initialized=!1}static initialize(){return"undefined"==typeof window||window.stickyHandler||(window.stickyHandler=new StickyHandler),window.stickyHandler}}const stickyHandler=new StickyHandler;function clearCache(e=null){e?cache.clear(e):(cache.clear(),cache.rewarm(),RandomGenerator.reset())}function resetAllData(){if(!confirm("Reset all data and inputs?"))return;let e=confirm("Also clear calculation cache?");if(e&&(cache.clear(),cache.rewarm(),RandomGenerator.reset()),AppState.reset(),debounceCleanupInterval&&(clearInterval(debounceCleanupInterval),debounceCleanupInterval=null),debounceMap.forEach(e=>{e?.timerId&&clearTimeout(e.timerId)}),debounceMap.clear(),void 0!==dropdownManager&&(dropdownManager.state.selectionOrder=[],dropdownManager.state.lockStates.clear(),dropdownManager.state.isSwapping=!1,dropdownManager.state.updateTimer&&(clearTimeout(dropdownManager.state.updateTimer),dropdownManager.state.updateTimer=null)),void 0!==stickyHandler){stickyHandler.scrollRAF&&(cancelAnimationFrame(stickyHandler.scrollRAF),stickyHandler.scrollRAF=null),stickyHandler.clearAllTimeouts&&stickyHandler.clearAllTimeouts(),stickyHandler.state&&(stickyHandler.state.isActive=!1,stickyHandler.state.isCollapsed=!1,stickyHandler.state.animating=!1);let t=stickyHandler.getOrderedButtons?stickyHandler.getOrderedButtons():[];t.forEach(e=>{e.classList.remove("sticky","collapsed"),e.style.cssText="",e.dataset.originalText&&(e.textContent=e.dataset.originalText)});let a=stickyHandler.elements?.get("toggleBtn");a&&(a.dataset.collapse="false")}void 0!==ValidationSSoTInstance&&(ValidationSSoTInstance.touchedFields.clear(),ValidationSSoTInstance.snackbarCooldowns.clear()),void 0!==SnackbarManager&&SnackbarManager.cleanup&&SnackbarManager.cleanup(),document.querySelectorAll('input[type="number"], input[type="text"], select, textarea').forEach(e=>{e.value="",e.disabled=!1,e.classList.remove("invalid-value");let t=e.closest(".input-wrap");t&&(t.classList.remove("locked"),delete t.dataset.tempUnlocked)}),DOM_ELEMENTS.hasil&&(DOM_ELEMENTS.hasil.innerHTML="",DOM_ELEMENTS.hasil.textContent="Input your stats to see the result...",delete DOM_ELEMENTS.hasil.dataset.showFullPrecision,delete DOM_ELEMENTS.hasil.dataset.specificMode),DOM_ELEMENTS.rec&&(DOM_ELEMENTS.rec.innerHTML="",DOM_ELEMENTS.rec.textContent="Balancing stat recommendations for a higher output multiplier."),DOM_ELEMENTS.submit&&(DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate"),[DOM_ELEMENTS.resetRek,DOM_ELEMENTS.resetAll,DOM_ELEMENTS.testSpear,DOM_ELEMENTS.testReaper].forEach(e=>{e&&(e.disabled=!0,e.classList.remove("activated"))}),document.querySelectorAll(".sticky").forEach(e=>{e.classList.remove("sticky","collapsed"),e.style.cssText="",e.dataset.originalText&&(e.textContent=e.dataset.originalText)});let r=document.getElementById("toggleStickyBtn");r&&(r.dataset.collapse="false"),DOM_ELEMENTS.snackbar&&(DOM_ELEMENTS.snackbar.classList.remove("show"),DOM_ELEMENTS.snackbar.style.cssText=""),delete window._lastSnackbarTime,void 0!==dropdownManager&&dropdownManager.init&&(dropdownManager.populateAllDropdowns(),dropdownManager.updateAll(),dropdownManager.syncThreeSets()),void 0!==ValidationSSoTInstance&&ValidationSSoTInstance.init&&ValidationSSoTInstance.init(),void 0!==stickyHandler&&stickyHandler.updateSticky&&stickyHandler.updateSticky();let l=e?"All data and cache cleared!":"All data reset!";if(DOM_ELEMENTS.topOfPage){let i=DOM_ELEMENTS.topOfPage.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:i,behavior:"smooth"})}else window.scrollTo({top:0,behavior:"smooth"});"function"==typeof showSnackbar&&setTimeout(()=>showSnackbar(l),300)}(()=>{let e="img-lightbox",t={overlay:document.getElementById("img-lightbox-overlay"),image:document.querySelector(".img-lightbox-image"),loader:document.querySelector(".img-lightbox-loader"),closeBtn:document.querySelector(".img-lightbox-close"),inner:document.querySelector(".img-lightbox-inner"),caption:document.querySelector(".img-lightbox-caption"),counter:document.querySelector(".img-lightbox-counter"),prevBtn:document.querySelector(".img-lightbox-prev"),nextBtn:document.querySelector(".img-lightbox-next")},a={scale:1,translateX:0,translateY:0,isDragging:!1,dragStartX:0,dragStartY:0,pinchStart:0,scaleStart:1,imageLoadId:null,galleries:{},currentGallery:null,currentIndex:0},r={MIN:1,MAX:5,STEP:.3},l=(e,t,a)=>Math.min(Math.max(e,t),a),i=(e,t)=>Math.hypot(e.clientX-t.clientX,e.clientY-t.clientY),n=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),s=()=>{t.image.style.transform=`translate(${a.translateX}px, ${a.translateY}px) scale(${a.scale})`},o=()=>{Object.assign(a,{scale:1,translateX:0,translateY:0,isDragging:!1}),s(),t.image.style.cursor="default"},d=()=>{t.image&&(t.image.onload=null,t.image.onerror=null),a.imageLoadId=null},c=()=>a.currentGallery?a.galleries[a.currentGallery]:[],u=()=>{let e=c();t.prevBtn.classList.toggle("disabled",0===a.currentIndex),t.nextBtn.classList.toggle("disabled",a.currentIndex===e.length-1)},p=()=>{let e=c();t.counter.textContent=`${a.currentIndex+1} / ${e.length}`},m=()=>{let e=c(),r=e[a.currentIndex];r&&r.caption?(t.caption.textContent=r.caption,t.caption.classList.add("active")):(t.caption.textContent="",t.caption.classList.remove("active"))},g=e=>{t.overlay.classList.toggle("img-lightbox-active",e),document.body.style.overflow=e?"hidden":"",e||(d(),o(),a.currentGallery=null)},h=e=>{let r=c();if(e<0||e>=r.length)return;a.currentIndex=e,d(),t.loader.style.display="block",t.image.style.display="none",o();let l=r[e],i=Symbol();a.imageLoadId=i,t.image.onload=()=>{a.imageLoadId===i&&(t.loader.style.display="none",t.image.style.display="block",d())},t.image.onerror=()=>{a.imageLoadId===i&&(t.loader.style.display="none",console.error("Failed to load image"),d())},t.image.src=l.src,u(),p(),m()},$=(e,t=0)=>{a.galleries[e]&&(a.currentGallery=e,g(!0),h(t))},b=()=>g(!1),M=()=>{a.currentIndex>0&&h(a.currentIndex-1)},E=()=>{let e=c();a.currentIndex<e.length-1&&h(a.currentIndex+1)},_=e=>{if(!t.overlay.classList.contains("img-lightbox-active"))return;e.preventDefault();let i=e.deltaY<0?r.STEP:-r.STEP,n=a.scale;if(a.scale=l(a.scale+i,r.MIN,r.MAX),a.scale!==n){if(a.scale===r.MIN)a.translateX=a.translateY=0;else{let o=a.scale/n;a.translateX=e.clientX-(e.clientX-a.translateX)*o,a.translateY=e.clientY-(e.clientY-a.translateY)*o}s(),t.image.style.cursor=a.scale>r.MIN?"move":"default"}},S=e=>{a.scale<=r.MIN||(a.isDragging=!0,a.dragStartX=e.clientX-a.translateX,a.dragStartY=e.clientY-a.translateY,t.image.style.cursor="grabbing",e.preventDefault())},f=e=>{a.isDragging&&(a.translateX=e.clientX-a.dragStartX,a.translateY=e.clientY-a.dragStartY,s())},v=()=>{a.isDragging&&(a.isDragging=!1,t.image.style.cursor=a.scale>r.MIN?"move":"default")},L=e=>{if(e.preventDefault(),a.scale>r.MIN)o();else{let l=t.image.getBoundingClientRect();a.scale=2,a.translateX=e.clientX-(e.clientX-l.left)*2,a.translateY=e.clientY-(e.clientY-l.top)*2,s(),t.image.style.cursor="move"}},y=e=>{let t=e.touches;1===t.length&&a.scale>r.MIN?(a.isDragging=!0,a.dragStartX=t[0].clientX-a.translateX,a.dragStartY=t[0].clientY-a.translateY):2===t.length&&(e.preventDefault(),a.isDragging=!1,a.pinchStart=i(t[0],t[1]),a.scaleStart=a.scale)},T=e=>{let t=e.touches;if(1===t.length&&a.isDragging)e.preventDefault(),a.translateX=t[0].clientX-a.dragStartX,a.translateY=t[0].clientY-a.dragStartY,s();else if(2===t.length&&a.pinchStart){e.preventDefault();let o=n(t[0],t[1]),d=i(t[0],t[1])/a.pinchStart,c=l(a.scaleStart*d,r.MIN,r.MAX),u=c/a.scale;a.scale=c,a.translateX=o.x-(o.x-a.translateX)*u,a.translateY=o.y-(o.y-a.translateY)*u,a.scale===r.MIN&&(a.translateX=a.translateY=0),s()}},w=e=>{0===e.touches.length?(a.isDragging=!1,a.pinchStart=0,a.scale===r.MIN&&(a.translateX=a.translateY=0,s())):1===e.touches.length&&a.scale>r.MIN&&(a.isDragging=!0,a.dragStartX=e.touches[0].clientX-a.translateX,a.dragStartY=e.touches[0].clientY-a.translateY,a.pinchStart=0)},D=e=>{if(!t.overlay.classList.contains("img-lightbox-active"))return;let a={Escape:b,0:o,ArrowLeft:M,ArrowRight:E};a[e.key]?.()},N=()=>{document.hidden&&a.isDragging&&(a.isDragging=!1,t.image.style.cursor=a.scale>r.MIN?"move":"default")},k=(e=document)=>{e.querySelectorAll("[data-lightbox-item]:not([data-lb-init])").forEach(e=>{e.setAttribute("data-lb-init","");let t=e.getAttribute("data-lightbox-item"),r=e.getAttribute("data-lightbox-image"),l=e.getAttribute("data-caption")||"";a.galleries[t]||(a.galleries[t]=[]),a.galleries[t].push({src:r,caption:l})}),e.querySelectorAll("[data-lightbox-trigger]:not([data-lb-trigger-init])").forEach(e=>{e.setAttribute("data-lb-trigger-init","");let t=e.getAttribute("data-lightbox-gallery");e.addEventListener("click",e=>{e.preventDefault(),t&&a.galleries[t]&&$(t,0)})}),e.querySelectorAll("[data-lightbox-image]:not([data-lightbox-trigger]):not([data-lb-single-init])").forEach(e=>{e.setAttribute("data-lb-single-init","");let t=e.getAttribute("data-lightbox-image"),r=e.getAttribute("data-caption")||"",l=`single-${Math.random().toString(36).substr(2,9)}`;a.galleries[l]=[{src:t,caption:r}],e.addEventListener("click",e=>{e.preventDefault(),$(l,0)})})};k();let A=new MutationObserver(e=>{for(let t of e)for(let a of t.addedNodes)1===a.nodeType&&((a.hasAttribute?.("data-lightbox-item")||a.hasAttribute?.("data-lightbox-trigger"))&&k(a.parentElement),a.querySelectorAll&&k(a))});A.observe(document.body,{childList:!0,subtree:!0});let O=[[t.closeBtn,"click",b],[t.prevBtn,"click",M],[t.nextBtn,"click",E],[t.overlay,"click",e=>e.target===t.overlay&&b()],[t.inner,"click",e=>e.stopPropagation()],[document,"keydown",D],[document,"visibilitychange",N],[t.image,"wheel",_,{passive:!1}],[t.image,"mousedown",S],[document,"mousemove",f],[document,"mouseup",v],[t.image,"dblclick",L],[t.image,"touchstart",y,{passive:!1}],[t.image,"touchmove",T,{passive:!1}],[t.image,"touchend",w],[t.image,"touchcancel",w]];O.forEach(([t,a,r,l])=>{EventManager.addNS(e,t,a,r,l)}),window.addEventListener("beforeunload",()=>{d(),A.disconnect(),EventManager.removeNS(e)},{once:!0})})(),(()=>{if(window._eventsAlreadyBound)return;window._eventsAlreadyBound=!0;let e=new Map([[DOM_ELEMENTS.testSpear,simulateFlash],[DOM_ELEMENTS.testReaper,simulateFlash],[DOM_ELEMENTS.submit,processMainCalculation],[DOM_ELEMENTS.resetRek,()=>{regenerateRecommendations(),showSnackbar?.("Table Refreshed!")}],[DOM_ELEMENTS.resetAll,resetAllData]]);window._buttonListenerIds=[],e.forEach((e,t)=>{if(t?.addEventListener){let a=EventManager.add(t,"click",e);window._buttonListenerIds.push(a),(t===DOM_ELEMENTS.testSpear||t===DOM_ELEMENTS.testReaper)&&t.classList.remove("activated")}})})();const cleanupAll=()=>{debounceCleanupInterval&&(clearInterval(debounceCleanupInterval),debounceCleanupInterval=null),debounceMap.forEach(e=>{e?.timerId&&clearTimeout(e.timerId)}),debounceMap.clear(),void 0!==EventManager&&(EventManager.forceCleanup?.(),EventManager.removeAll?.()),void 0!==AppState&&AppState.clearListeners?.(),ValidationSSoTInstance?.destroy(),TooltipManager?.destroyAll(),SnackbarManager?.destroy(),dropdownManager?.destroy(),stickyHandler?.destroy(),accordionManager?.destroy(),modalManager?.destroy(),void 0!==cache&&cache.clear(),void 0!==RandomGenerator&&RandomGenerator.reset(),window.debounceMap&&(window.debounceMap.forEach(e=>clearTimeout(e)),window.debounceMap.clear()),window._buttonListenerIds&&void 0!==EventManager&&(window._buttonListenerIds.forEach(e=>EventManager.remove?.(e)),window._buttonListenerIds=[]),delete window._eventsAlreadyBound,delete window._lastSnackbarTime};EventManager.add(window,"beforeunload",cleanupAll),"undefined"!=typeof window&&(window.__forceCleanup=cleanupAll);
